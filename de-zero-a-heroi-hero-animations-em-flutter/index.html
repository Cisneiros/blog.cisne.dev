<!DOCTYPE html><html lang="pt-BR" class=" "><head><meta name="generator" content="React Static"/><title data-react-helmet="true">De zero a heroi: Hero animations em Flutter · Cisne.dev blog</title><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Cisneiros"/><meta data-react-helmet="true" property="og:title" content="De zero a heroi: Hero animations em Flutter · Cisne.dev blog"/><meta data-react-helmet="true" property="og:image" content="https://blog.cisne.dev/de-zero-a-heroi-hero-animations-em-flutter/social-image.png"/><meta data-react-helmet="true" name="twitter:title" content="De zero a heroi: Hero animations em Flutter · Cisne.dev blog"/><meta data-react-helmet="true" name="twitter:image" content="https://blog.cisne.dev/de-zero-a-heroi-hero-animations-em-flutter/social-image.png"/><link rel="preload" as="script" href="/templates/vendors~__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.207edc50.js"/><link rel="preload" as="script" href="/templates/__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.a04ea84b.js"/><link rel="preload" as="script" href="/templates/__react_static_root__/src/containers/post.d8dd52db.js"/><link rel="preload" as="script" href="/templates/vendors~main.272ae1d1.js"/><link rel="preload" as="script" href="/main.f19d4c14.js"/><link data-react-helmet="true" rel="stylesheet" href="//unpkg.com/dracula-prism/dist/css/dracula-prism.min.css"/><style data-styled="" data-styled-version="5.1.1">.CfxHf{max-width:960px;margin:0 auto;position:relative;}/*!sc*/
data-styled.g1[id="ui__Fit-prwz6b-0"]{content:"CfxHf,"}/*!sc*/
.iuDFSN{padding:1rem;color:var(--color-mid);text-align:center;font-size:1.5rem;}/*!sc*/
.iuDFSN a,.iuDFSN a:hover{-webkit-text-decoration:none;text-decoration:none;color:inherit;}/*!sc*/
data-styled.g2[id="Navigation__Container-sc-1yk0pqp-0"]{content:"iuDFSN,"}/*!sc*/
.izuwCZ{max-width:960px;margin:0 auto;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g3[id="Navigation__NavFit-sc-1yk0pqp-1"]{content:"izuwCZ,"}/*!sc*/
.TctaC{width:2.5rem;height:1.2em;overflow:hidden;--default-rotation:-180deg;}/*!sc*/
@media (prefers-color-scheme:dark){.TctaC{--default-rotation:0;}}/*!sc*/
data-styled.g4[id="Navigation__BrightnessContainer-sc-1yk0pqp-2"]{content:"TctaC,"}/*!sc*/
.sLeDt{-webkit-transform:rotate(var(--default-rotation));-ms-transform:rotate(var(--default-rotation));transform:rotate(var(--default-rotation));-webkit-transition:-webkit-transform 0.3s ease-out;-webkit-transition:transform 0.3s ease-out;transition:transform 0.3s ease-out;}/*!sc*/
html.light .sLeDt{-webkit-transform:rotate(-180deg);-ms-transform:rotate(-180deg);transform:rotate(-180deg);}/*!sc*/
html.dark .sLeDt{-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);}/*!sc*/
data-styled.g5[id="Navigation__BrightnessSpinner-sc-1yk0pqp-3"]{content:"sLeDt,"}/*!sc*/
.frsARl{background:none;border:none;cursor:pointer;}/*!sc*/
.frsARl:last-child{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg);}/*!sc*/
data-styled.g7[id="Navigation__BrightnessIcon-sc-1yk0pqp-5"]{content:"frsARl,"}/*!sc*/
.gdHjSq{margin-top:3rem;padding:1rem;background:var(--color-foreground);color:var(--color-background);}/*!sc*/
.gdHjSq a{color:var(--text-inverse-color-1);}/*!sc*/
.gdHjSq a:hover{color:var(--text-inverse-color-3);}/*!sc*/
data-styled.g8[id="Footer__Container-b3q04c-0"]{content:"gdHjSq,"}/*!sc*/
.layJcq{max-width:960px;margin:0 auto;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g9[id="Footer__FooterFit-b3q04c-1"]{content:"layJcq,"}/*!sc*/
*{box-sizing:border-box;margin:0;padding:0;border:0;font-size:inherit;font-weight:inherit;font-style:inherit;}/*!sc*/
:root{--color-1:#12c2e9;--color-2:#c471ed;--color-3:#f64f59;--color-1-darker:#0A7B94;--color-2-darker:#AE3CE7;--color-3-darker:#E90C1B;--color-light:#fefefe;--color-dark:#030303;--color-mid-dark:#747481;--color-mid-light:#818181;--font-weight-light:300;--font-weight-regular:400;--font-weight-heavy:500;--font-family-light:"HelveticaNeue-Light","Helvetica Neue Light",'Helvetica Neue',sans-serif;--font-family:'Helvetica Neue',sans-serif;}/*!sc*/
strong,h1,h2,h3,h4,h5,h6{font-family:var(--font-family);}/*!sc*/
html{font-family:var(--font-family-light);font-size:20px;line-height:1;color:var(--color-foreground);background-color:var(--color-background);text-rendering:optimizeLegibility;}/*!sc*/
@media (max-width:600px){html{font-size:16px;}}/*!sc*/
html,html.light{--color-background:var(--color-light);--color-foreground:var(--color-dark);--color-mid:var(--color-mid-dark);--text-color-1:var(--color-1-darker);--text-color-2:var(--color-2-darker);--text-color-3:var(--color-3-darker);--text-inverse-color-1:var(--color-1);--text-inverse-color-2:var(--color-2);--text-inverse-color-3:var(--color-3);}/*!sc*/
html.dark{--color-background:var(--color-dark);--color-foreground:var(--color-light);--color-mid:var(--color-mid-light);--text-color-1:var(--color-1);--text-color-2:var(--color-2);--text-color-3:var(--color-3);--text-inverse-color-1:var(--color-1-darker);--text-inverse-color-2:var(--color-2-darker);--text-inverse-color-3:var(--color-3-darker);}/*!sc*/
@media (prefers-color-scheme:dark){html{--color-background:var(--color-dark);--color-foreground:var(--color-light);--color-mid:var(--color-mid-light);}}/*!sc*/
body{font-size:1em;font-weight:var(--font-weight-light);}/*!sc*/
strong{font-weight:var(--font-weight-heavy);}/*!sc*/
em{font-style:italic;}/*!sc*/
main{padding:1rem;}/*!sc*/
hr{width:30%;margin:4rem auto;border:none;border-bottom:dotted 1px var(--color-1);}/*!sc*/
.pagination{text-align:center;}/*!sc*/
.pagination a{color:var(--text-color-1);}/*!sc*/
.pagination a:hover{color:var(--text-color-3);}/*!sc*/
a{color:var(--text-color-1);-webkit-text-decoration-color:#c471ed80;text-decoration-color:#c471ed80;-webkit-text-decoration-style:wavy;text-decoration-style:wavy;}/*!sc*/
a:hover{color:var(--text-color-3);-webkit-text-decoration-color:#12c2e980;text-decoration-color:#12c2e980;}/*!sc*/
.phone-mockup{max-width:15rem;margin:0 auto 1rem;position:relative;}/*!sc*/
.phone-mockup::before{content:'';width:100%;height:100%;position:absolute;pointer-events:none;background:url(/iphone-11-pro.png) no-repeat;background-size:contain;}/*!sc*/
.phone-mockup video,.phone-mockup img{width:100%;padding:9.3%;}/*!sc*/
data-styled.g14[id="sc-global-hFBrmQ1"]{content:"sc-global-hFBrmQ1,"}/*!sc*/
.jORPuT{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g21[id="MarkdownRendererstyles__FlexContainer-i4h55e-6"]{content:"jORPuT,"}/*!sc*/
.tuaWG{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
@media (max-width:600px){.tuaWG{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}/*!sc*/
data-styled.g23[id="Poststyles__AfterPost-sc-12qb97v-0"]{content:"tuaWG,"}/*!sc*/
.gkeqUt{-webkit-flex:1;-ms-flex:1;flex:1;}/*!sc*/
@media (max-width:600px){.gkeqUt{text-align:center;margin-bottom:1rem;}}/*!sc*/
data-styled.g24[id="Poststyles__AfterPostChild-sc-12qb97v-1"]{content:"gkeqUt,"}/*!sc*/
.fAvgXR{-webkit-flex:1;-ms-flex:1;flex:1;text-align:right;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}/*!sc*/
@media (max-width:600px){.fAvgXR{text-align:center;margin-bottom:1rem;}}/*!sc*/
data-styled.g25[id="Poststyles__Tags-sc-12qb97v-2"]{content:"fAvgXR,"}/*!sc*/
.kSZCZX::before{content:' #';color:var(--color-mid);}/*!sc*/
data-styled.g26[id="Poststyles__Tag-sc-12qb97v-3"]{content:"kSZCZX,"}/*!sc*/
.kyWzPB{-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;}/*!sc*/
data-styled.g27[id="Poststyles__Container-sc-12qb97v-4"]{content:"kyWzPB,"}/*!sc*/
.hhBwVH{font-size:5rem;font-weight:var(--font-weight-regular);line-height:0.8;background:linear-gradient(var(--color-1),var(--color-2),var(--color-3));-webkit-text-fill-color:transparent;background-clip:text;-webkit-background-clip:text;padding-bottom:1rem;margin:1rem 0;}/*!sc*/
html.rainbow .hhBwVH{background-image:linear-gradient(124deg,#ff2400,#e81d1d,#e8b71d,#e3e81d,#1de840,#1ddde8,#2b1de8,#dd00f3,#dd00f3);-webkit-animation:hTUzwZ 9s ease infinite;animation:hTUzwZ 9s ease infinite;background-size:450% 450%;}/*!sc*/
@media (max-width:600px){.hhBwVH{font-size:3.5rem;}}/*!sc*/
.hhBwVH a{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g28[id="Poststyles__Title-sc-12qb97v-5"]{content:"hhBwVH,"}/*!sc*/
.fonWHZ{color:var(--color-mid);text-align:center;margin-bottom:2rem;}/*!sc*/
data-styled.g29[id="Poststyles__Meta-sc-12qb97v-6"]{content:"fonWHZ,"}/*!sc*/
.jhgzPU{line-height:1.6;}/*!sc*/
.jhgzPU h2{font-size:2.5rem;}/*!sc*/
.jhgzPU h3{font-size:2rem;}/*!sc*/
.jhgzPU h4{font-size:1.5rem;}/*!sc*/
.jhgzPU h2,.jhgzPU h3,.jhgzPU h4,.jhgzPU h5,.jhgzPU h6{-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;font-weight:var(--font-weight-regular);line-height:0.8;padding-bottom:1rem;margin-top:2rem;}/*!sc*/
.jhgzPU img{max-width:100%;}/*!sc*/
.jhgzPU pre.refractor{margin-top:0;margin-left:0;padding-left:1rem;border-left:solid 0.25rem var(--color-1);border-radius:0;font-size:0.8rem;overflow-wrap:normal;overflow-x:auto;background-color:var(--color-dark);color:var(--color-light);padding-top:0.5rem;padding-bottom:0.5rem;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}/*!sc*/
.jhgzPU pre.refractor::-webkit-scrollbar{width:0.25rem;height:0.25rem;}/*!sc*/
.jhgzPU pre.refractor code,.jhgzPU code{font-family:'Fira Code','Menlo',monospace;}/*!sc*/
.jhgzPU p code{color:var(--text-color-3);}/*!sc*/
.jhgzPU p code,.jhgzPU h1 code,.jhgzPU h2 code,.jhgzPU h3 code,.jhgzPU h4 code,.jhgzPU h5 code,.jhgzPU h6 code{font-size:0.9em;}/*!sc*/
.jhgzPU p,.jhgzPU pre,.jhgzPU ul,.jhgzPU ol,.jhgzPU table,.jhgzPU blockquote,.jhgzPU .live-code-container{margin-bottom:1rem;}/*!sc*/
.jhgzPU twitter-widget{margin-bottom:1rem !important;}/*!sc*/
.jhgzPU p:last-child,.jhgzPU pre:last-child,.jhgzPU ul:last-child,.jhgzPU ol:last-child,.jhgzPU table:last-child,.jhgzPU blockquote:last-child,.jhgzPU .live-code-container:last-child{margin-bottom:0;}/*!sc*/
.jhgzPU ul,.jhgzPU ol{list-style:none;margin-left:1rem;counter-reset:li;}/*!sc*/
.jhgzPU li{counter-increment:li;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
.jhgzPU ul li::before{content:'•';margin-right:0.5rem;color:var(--color-2);}/*!sc*/
.jhgzPU ol li::before{content:"."counter(li);margin-right:0.5rem;color:var(--color-2);font-weight:var(--font-weight-regular);width:1em;display:inline-block;margin-left:-0.5em;margin-right:0.5em;text-align:right;direction:rtl;}/*!sc*/
.jhgzPU table{margin-left:auto;margin-right:auto;border-spacing:0;font-size:0.9em;}/*!sc*/
.jhgzPU td,.jhgzPU th{border-bottom:solid 1px var(--color-2);padding:0.5rem;}/*!sc*/
.jhgzPU th{font-weight:var(--font-weight-heavy);}/*!sc*/
.jhgzPU tr:hover{background:var(--color-2);}/*!sc*/
.jhgzPU tr:last-of-type td{border-bottom:0;}/*!sc*/
.jhgzPU blockquote{padding-left:1rem;border-left:solid 0.25rem var(--color-3);color:var(--color-mid);}/*!sc*/
data-styled.g30[id="Poststyles__Content-sc-12qb97v-7"]{content:"jhgzPU,"}/*!sc*/
.jjKdZc{position:fixed;top:0;left:0;right:0;height:0.25rem;background-color:var(--color-1);-webkit-transition:opacity 0.25s ease-out;transition:opacity 0.25s ease-out;z-index:2;}/*!sc*/
data-styled.g31[id="post__ScrollTrackerContainer-gh0jqu-0"]{content:"jjKdZc,"}/*!sc*/
@-webkit-keyframes hTUzwZ{0%{background-position:0% 82%;}50%{background-position:100% 19%;}100%{background-position:0% 82%;}}/*!sc*/
@keyframes hTUzwZ{0%{background-position:0% 82%;}50%{background-position:100% 19%;}100%{background-position:0% 82%;}}/*!sc*/
data-styled.g32[id="sc-keyframes-hTUzwZ"]{content:"hTUzwZ,"}/*!sc*/
</style><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml"/></head><body><div id="root"><nav class="Navigation__Container-sc-1yk0pqp-0 iuDFSN"><div class="ui__Fit-prwz6b-0 Navigation__NavFit-sc-1yk0pqp-1 izuwCZ"><p class="logo"><a href="/">Cisne.dev blog</a></p><div class="Navigation__BrightnessContainer-sc-1yk0pqp-2 TctaC"><div class="Navigation__BrightnessSpinner-sc-1yk0pqp-3 sLeDt"><button title="Mudar para modo diurno" aria-label="Mudar para modo diurno" class="Navigation__ClearButton-sc-1yk0pqp-4 Navigation__BrightnessIcon-sc-1yk0pqp-5 frsARl">🌙</button><button title="Mudar para modo noturno" aria-label="Mudar para modo noturno" class="Navigation__ClearButton-sc-1yk0pqp-4 Navigation__BrightnessIcon-sc-1yk0pqp-5 frsARl">☀️</button></div></div></div></nav><main><div class="ui__Fit-prwz6b-0 CfxHf"><div><div style="width:0%;opacity:0" class="post__ScrollTrackerContainer-gh0jqu-0 jjKdZc"></div><article class="Poststyles__Container-sc-12qb97v-4 kyWzPB"><h1 class="Poststyles__Title-sc-12qb97v-5 hhBwVH"><a href="/de-zero-a-heroi-hero-animations-em-flutter/">De zero a heroi: Hero animations em Flutter</a></h1><p class="Poststyles__Meta-sc-12qb97v-6 fonWHZ">Publicado em <!-- -->31 ago 2020<!-- -->. Uns <!-- -->17<!-- --> minutos de leitura.</p><div class="Poststyles__Content-sc-12qb97v-7 jhgzPU content"><p>Animações são uma excelente maneira de tornar um app mais interativo e engajar os usuários. Flutter tem várias opções para criar animações, com diferentes níveis de complexididade. Uma das (se não a) mais simples são as <strong>Hero animations</strong>, que, com apenas um widget, permitem animar um componente durante a transição entre duas telas. Vamos ver como fazer uma animação super rápida e explorar possibilidades mais avançadas para criar animações mais complexas com essa ferramenta.</p><span><!-- summary-break --></span><p>Antes de começar, alguns exemplos de animações que vamos implementar neste post:</p><div class="MarkdownRendererstyles__FlexContainer-i4h55e-6 jORPuT"><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-3.mp4" type="video/mp4"/><p><a href="/media/hero-3.mp4">Vídeo mostrando uma imagem do Pokémon Charizard e um botão para avançar para a próxima tela. Ao tocar no botão, uma transição avança para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. Ao puxar com o dedo para voltar para a tela anterior, o Charizard acompanha a transição. </a></p></video></p></div><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-4.mp4" type="video/mp4"/><p><a href="/media/hero-4.mp4">Vídeo mostrando uma lista de Pokémon, com número, imagem e nome. Ao tocar no Charizard, uma nova tela de detalhes deste Pokémon aparece a imagem e o número dele voam da lista para essa nova tela. O mesmo acontece ao voltar para a lista e selecionar outro Pokémon, o Blastoise. </a></p></video></p></div><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-5.mp4" type="video/mp4"/><p><a href="/media/hero-5.mp4">Vídeo mostrando uma tela com detalhes de uma compra de uma almofada do Pokémon Pikachu, com nome do produto, imagem, preço e data de entrega. Abaixo há um botão vermelho para finalizar a compra. Ao tocar nele, o botão fica cinza e o texto vira um indicador de carregamento. Após um tempo, o botão fica verde e um ícone de sucesso aparece nele. Em seguida, o botão começa a crescer até tomar a tela inteira, que fica toda verde. Aparece os textos da tela de sucesso da compra e um botão que, ao ser tocado, fecha e volta para o início do app. </a></p></video></p></div></div><p>Tudo começa com o widget <code>Hero</code>. Ele serve para identificar, nas telas de origem e destino da transição, <strong>qual é o widget que vai ser animado</strong>. Ele recebe um atributo <code>child</code> que é o widget e um outro <code>tag</code>, que deve ser igual nas duas telas (isso permite ter mais de uma Hero animation ao mesmo tempo).</p><pre class="refractor language-js"><code class="language-js"><span class="token function">Hero</span><span class="token punctuation">(</span>
  tag<span class="token operator">:</span> <span class="token string">&#x27;charizard&#x27;</span><span class="token punctuation">,</span>
  child<span class="token operator">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span><span class="token string">&#x27;https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span></code></pre><h2>Animando um widget durante uma transição de telas</h2><p>No exemplo acima, envolvemos um widget <code>Image</code> com um <code>Hero</code>. Agora, só precisamos colocar este <code>Hero</code> em duas telas e criar uma transição entre elas.</p><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-1.mp4" type="video/mp4"/><p><a href="/media/hero-1.mp4">Vídeo mostrando uma imagem do Pokémon Charizard e um botão para avançar para a próxima tela. Ao tocar no botão, uma transição avança para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. </a></p></video></p></div><pre class="refractor language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">FirstScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  @override
  Widget <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">BuildContext context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token operator">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        title<span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;First screen&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token comment">// O Hero na primeira tela</span>
          <span class="token function">Hero</span><span class="token punctuation">(</span>
            tag<span class="token operator">:</span> <span class="token string">&#x27;charizard&#x27;</span><span class="token punctuation">,</span>
            child<span class="token operator">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                <span class="token string">&#x27;https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">RaisedButton</span><span class="token punctuation">(</span>
            child<span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;Go to next screen&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            onPressed<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
                <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span><span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">SecondScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SecondScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  @override
  Widget <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">BuildContext context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token operator">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>
        title<span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;Second screen&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
        <span class="token comment">// O mesmo Hero na segunda tela</span>
        child<span class="token operator">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>
          tag<span class="token operator">:</span> <span class="token string">&#x27;charizard&#x27;</span><span class="token punctuation">,</span>
          child<span class="token operator">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
              <span class="token string">&#x27;https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>E é isso! Com apenas um widget em cada tela, temos essa animação na transição. Ela funciona tanto na ida como na volta e já dá um efeito legal.</p><p>Em algumas plataformas, como no iOS, é costumeiro o usuário poder voltar para a tela anterior deslizando o dedo do canto da tela. Por padrão, Hero animations <strong>não vão animar nesse tipo de transção</strong>. Se você quiser que anime, é só adicionar o atributo <code>transitionOnUserGestures</code> nos dois <code>Hero</code>s, assim:</p><pre class="refractor language-js"><code class="language-js"><span class="token function">Hero</span><span class="token punctuation">(</span>
  tag<span class="token operator">:</span> <span class="token string">&#x27;charizard&#x27;</span><span class="token punctuation">,</span>
  transitionOnUserGestures<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// O novo atributo</span>
  child<span class="token operator">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span><span class="token string">&#x27;https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span></code></pre><p>Nos vídeos abaixo, temos um exemplo de usuário arrastando a tela para voltar sem e com <code>transitionOnUserGestures</code>, respectivamente.</p><div class="MarkdownRendererstyles__FlexContainer-i4h55e-6 jORPuT"><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-2.mp4" type="video/mp4"/><p><a href="/media/hero-2.mp4">Vídeo mostrando uma imagem do Pokémon Charizard e um botão para avançar para a próxima tela. Ao tocar no botão, uma transição avança para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. Ao puxar com o dedo para voltar para a tela anterior, o Charizard não acompanha a transição, aparecendo separadamente nas duas telas. </a></p></video></p></div><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-3.mp4" type="video/mp4"/><p><a href="/media/hero-3.mp4">Vídeo mostrando uma imagem do Pokémon Charizard e um botão para avançar para a próxima tela. Ao tocar no botão, uma transição avança para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. Ao puxar com o dedo para voltar para a tela anterior, o Charizard acompanha a transição. </a></p></video></p></div></div><p>Como eu comentei antes, é possível ter mais de um <code>Hero</code> na mesma tela. E não necessariamente você precisa ter um correspondente nas duas telas, pois se uma transição encontrar um <code>Hero</code> de um lado só, ela não vai animar o elemento mas nenhum erro acontecerá. Podemos usar isso para fazer uma animação dos elementos de uma lista para uma tela de detalhes.</p><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-4.mp4" type="video/mp4"/><p><a href="/media/hero-4.mp4">Vídeo mostrando uma lista de Pokémon, com número, imagem e nome. Ao tocar no Charizard, uma nova tela de detalhes deste Pokémon aparece a imagem e o número dele voam da lista para essa nova tela. O mesmo acontece ao voltar para a lista e selecionar outro Pokémon, o Blastoise. </a></p></video></p></div><p>Para isso, precisamos apenas garantir que a <code>tag</code> vai ser <strong>única entre os elementos</strong> e que conseguimos <strong>replicá-la na segunda tela</strong>. Neste exemplo, vamos partir de uma classe <code>Pokemon</code> que tem um atributo <code>number</code>, único entre cada espécie de Pokémon. Para montar a lista, usei um <code>SliverGrid</code> que serve para montar uma lista em formato de Grid dentro de um <code>CustomScrollView</code>. Como Slivers funcionam é assunto pra outra conversa, mas o que é relevante é que ele recebe uma classe com um builder que, para cada item da lista, vai renderizar um widget.</p><pre class="refractor language-js"><code class="language-js"><span class="token function">SliverChildBuilderDelegate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  final pokemon <span class="token operator">=</span> pokedex<span class="token punctuation">.</span><span class="token function">pokemonNumbered</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
    <span class="token function-variable function">onTap</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toPokemonDetail</span><span class="token punctuation">(</span>pokemon<span class="token punctuation">)</span><span class="token punctuation">,</span>
    child<span class="token operator">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>
      tag<span class="token operator">:</span> <span class="token string">&#x27;sprite-${pokemon.number}&#x27;</span><span class="token punctuation">,</span>
      transitionOnUserGestures<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      child<span class="token operator">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>pokemon<span class="token punctuation">.</span>spriteUrl<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Na <code>tag</code>, vamos gerar uma string usando o número do Pokémon. Na tela de detalhe, só precisamos repetir a mesma <code>tag</code> e a Hero animation vai funcionar. Como a tela de detalhe recebe como parâmetro o Pokémon para exibir, ela tem o número dele e pode criar um <code>Hero</code> com a mesma <code>tag</code>. Todos os outros <code>Hero</code>s na lista não vão ter um correspondente na tela de detalhe, então eles não serão animados.</p><p>No vídeo do exemplo, eu coloquei um segundo <code>Hero</code> para animar o número do Pokémon, também. É a mesma ideia, mas ao invés do <code>child</code> ser uma imagem, é um texto. A <code>tag</code> precisa ser diferente, e por isso eu coloquei o prefixo &quot;sprite&quot; na <code>tag</code> do primeiro exemplo. Para o número, você pode usar <code>&#x27;number-${pokemon.number}&#x27;</code>.</p><p>Note que o estado inicial e final não precisam ter o mesmo tamanho. O <code>Hero</code> vai interpolar as dimensões automaticamente. Na maioria dos casos, isso é suficiente, mas existem maneiras de modificar o funcionamento das transições. Isso é particulamente interessante quando usamos uma Hero animation em que o estado inicial e final não são o mesmo widget, e eles podem ter filhos com layouts diferentes e que, se apenas interpolarmos as dimensões, podemos ter comportamentos estranhos.</p><h2>Redefinindo o comportamento de transição</h2><p>Vamos dar uma olhada num uso mais avançado do <code>Hero</code>. Nos exemplos anteriores, nós apenas definimos o estado final e inicial. Nosso objetivo vai ser implementar uma animação assim:</p><div class="phone-mockup"><p><video controls="" playsinline="" autoplay="" muted="" loop=""><source src="/media/hero-5.mp4" type="video/mp4"/><p><a href="/media/hero-5.mp4">Vídeo mostrando uma tela com detalhes de uma compra de uma almofada do Pokémon Pikachu, com nome do produto, imagem, preço e data de entrega. Abaixo há um botão vermelho para finalizar a compra. Ao tocar nele, o botão fica cinza e o texto vira um indicador de carregamento. Após um tempo, o botão fica verde e um ícone de sucesso aparece nele. Em seguida, o botão começa a crescer até tomar a tela inteira, que fica toda verde. Aparece os textos da tela de sucesso da compra e um botão que, ao ser tocado, fecha e volta para o início do app. </a></p></video></p></div><p>Como o código-fonte desse exemplo é um pouco maior, vou explicar alguns dos novos conceitos primeiro e depois colocar o código completo do exemplo.</p><p>Separando em partes, o que acontece no exemplo é:</p><ol><li>Ao clicar no botão, ele diminui e mostra um indicador de carregamento.</li><li>Após um tempo, ele fica verde e mostra um ícone de sucesso.</li><li>O botão expande e toma a tela inteira, deixando-a verde.</li><li>Uma mensagem de sucesso aparece na tela verde.</li><li>Ao tocar no botão que apareceu agora, a tela fecha.</li></ol><p>Para simular uma transação, a tela é um <code>StatefulWidget</code> que tem um atributo para guardar o seu estado. Ele pode ter o valor <code>waiting</code> (inicial), <code>processing</code> e <code>successful</code>. Não há nenhuma comunicação real acontecendo, e a mudança entre estados acontece usando <code>await</code> em timers, quando o botão é clicado.</p><pre class="refractor language-js"><code class="language-js"><span class="token function">RawMaterialButton</span><span class="token punctuation">(</span>
  onPressed<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> async <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseState <span class="token operator">!=</span> PurchaseState<span class="token punctuation">.</span>waiting<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      purchaseState <span class="token operator">=</span> PurchaseState<span class="token punctuation">.</span>processing<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> Future<span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      purchaseState <span class="token operator">=</span> PurchaseState<span class="token punctuation">.</span>successful<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> Future<span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">pushReplacement</span><span class="token punctuation">(</span><span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>
      <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">SuccessScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      fullscreenDialog<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  fillColor<span class="token operator">:</span> _buttonColor<span class="token punctuation">,</span>
  shape<span class="token operator">:</span> _buttonShape<span class="token punctuation">,</span>
  child<span class="token operator">:</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
    height<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    child<span class="token operator">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token operator">:</span> _buttonChild<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span></code></pre><p>As propriedades <code>_buttonColor</code>, <code>_buttonShape</code> e <code>_buttonChild</code> são <em>getters</em> adicionados no widget que fazem um <code>switch/case</code> no estado e retornam a cor de fundo, formato e conteúdo do botão, respectivamente.</p><p>Os ítens 1 e 2 da lista são presentes do <code>RawMaterialButton</code>, uma classe base para criar botões no Material Design. O botão mudar de um formato de pílula para um círculo acontece pois mudamos o seu atributo <code>Shape</code>. O <code>RawMaterialButton</code> anima essa mudança de formato automaticamente.</p><p>O item 3, a expansão do botão até tomar a tela toda, que é o nosso foco. Ele é uma Hero animation. Pode não parecer óbvio pois, ao clicar, não vemos uma nova tela abrindo e um widget voando da tela antiga para a nova. O segredo é que o widget de destino é <strong>a tela nova inteira</strong>. Na tela de origem, o <code>Hero</code> está em volta do botão. Já na tela de destino, o <code>Hero</code> está em volta da tela toda. Isso faz com que o botão se transforme na tela seguinte inteira.</p><p>Se você olhar no código-fonte do exemplo, que está todo na próxima seção, vai notar que o <code>Hero</code> da tela de destino é um pouco diferente dos que fizemos até agora (além do fato de ele englobar uma tela inteira). Ele tem dois atributos que não usamos ainda: <code>flightShuttleBuilder</code> e <code>createRectTween</code>. Precisamos desses dois atributos para deixar o efeito com a cara que ficou.</p><p>Começando pelo <code>flightShuttleBuilder</code>, ele serve para definir <strong>como renderizar o widget durante a transição</strong>. Por padrão, o próprio widget é usado na transição (nos exemplos dos Pokémon, nós vemos a sprite ele se mover de uma tela para a outra). Porém, neste caso, o botão começa bem pequeno e cresce até ocupar a tela toda. Porém, o widget da tela em si possui textos e outros elementos grandes, que dependem do espaço disponível para que seu layout seja calculado. Durante a transição (e expansão), esse espaço vai ser insuficiente e vamos ter problemas de overflow.</p><p>Há mais de uma maneira de resolver isso, mas eu parti para uma bem simples: durante a transição, vamos renderizar o widget apenas como um círculo verde expandindo. Ele já vai começar como um círculo verde, no sucesso da compra, e vai expandir com um raio que, garantidamente, vai preencher a tela inteira.</p><pre class="refractor language-js"><code class="language-js"><span class="token function">Hero</span><span class="token punctuation">(</span>
  <span class="token comment">// ...</span>
  flightShuttleBuilder<span class="token operator">:</span> <span class="token punctuation">(</span>flightContext<span class="token punctuation">,</span> animation<span class="token punctuation">,</span> flightDirection<span class="token punctuation">,</span>
      fromHeroContext<span class="token punctuation">,</span> toHeroContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      decoration<span class="token operator">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
        color<span class="token operator">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>
        shape<span class="token operator">:</span> BoxShape<span class="token punctuation">.</span>circle<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span></code></pre><p>O <code>flightShuttleBuilder</code> recebe cinco parâmetros, que deixei explícitos no exemplo acima para ilustrar suas existências. Não precisamos deles pois vamos renderizar, em todos os quadros da animação, o mesmo círculo verde. Mas temos acesso ao contexto das telas originais e finais, da transição, a direção dessa transição e, talvez mais interessante, a <code>animation</code> em si. Ela pode ser usada para modificar o widget durante a transição de acordo com o progresso da animação (que estará em <code>animation.value</code>, de zero a um).</p><p>Eu comentei acima sobre <strong>garantir que o raio do círculo vai cubrir a tela inteira</strong>. O <code>flightShuttleBuilder</code> acima não tem nada sobre isso. Para isso vamos usar a outra nova propriedade: <code>createRectTween</code>. Ela serve para definir a área e a posição ocupadas pelo widget durante a transição. Quando não definimos essa propriedade, por padrão a Hero animation vai desenhar o widget num retângulo onde o <code>Hero</code> estava na primeira tela e interpolar até o retângulo em que o <code>Hero</code> está na segunda tela. Ou seja, o widget original aparenta se mover e mudar de tamanho para se transformar nas dimensões da tela de destino.</p><p>Para a animação que queria fazer, meu objetivo era que o círculo expandisse <strong>sem sair do lugar</strong>, ou seja, <strong>sem mudar seu centro</strong>. Para isso, precisava que o retângulo de origem e destino tivessem o mesmo centro, e que o retângulo de destino crescesse o suficiente para que o círculo do nosso <code>flightShuttleBuilder</code> cobrisse a tela inteira. Flutter já tem maneiras de interpolar dois retângulos (com <code>Rect.lerp()</code>), então eu preciso apenas definir quais são os retângulos inicial e final.</p><p>O retângulo inicial é o próprio botão. Ele convenientemente já é um quadrado que tem um círculo verde dentro (o botão). Já o retângulo final precisa <strong>conter um círculo que contenha a tela inteira</strong>. Isso é meio confuso, mas a ideia é que o raio do círculo precisa ser a <strong>distância entre o centro do círculo e o canto da tela mais longe dele</strong>. É isso que vamos calcular no construtor da classe <code>HeroTween</code>, abaixo. Fazemos isso no construtor pois os retângulos inicial e final não mudam durante a animação.</p><pre class="refractor language-js"><code class="language-js"><span class="token function">Hero</span><span class="token punctuation">(</span>
  <span class="token comment">// ...</span>
  createRectTween<span class="token operator">:</span> <span class="token punctuation">(</span>begin<span class="token punctuation">,</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">HeroTween</span><span class="token punctuation">(</span>begin<span class="token operator">:</span> begin<span class="token punctuation">,</span> end<span class="token operator">:</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">// ...</span>

<span class="token keyword">class</span> <span class="token class-name">HeroTween</span> <span class="token keyword">extends</span> <span class="token class-name">RectTween</span> <span class="token punctuation">{</span>
  <span class="token function">HeroTween</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Rect begin<span class="token punctuation">,</span> Rect end<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> radius <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          end<span class="token punctuation">.</span>topLeft<span class="token punctuation">,</span>
          end<span class="token punctuation">.</span>topRight<span class="token punctuation">,</span>
          end<span class="token punctuation">.</span>bottomLeft<span class="token punctuation">,</span>
          end<span class="token punctuation">.</span>bottomRight
        <span class="token punctuation">]</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> begin<span class="token punctuation">.</span>center <span class="token operator">-</span> p<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>distanceSquared<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>begin<span class="token operator">:</span> begin<span class="token punctuation">,</span> end<span class="token operator">:</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>

  final double radius<span class="token punctuation">;</span>

  @override
  Rect <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token parameter">double t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">lerp</span><span class="token punctuation">(</span>
        begin<span class="token punctuation">,</span> Rect<span class="token punctuation">.</span><span class="token function">fromCircle</span><span class="token punctuation">(</span>center<span class="token operator">:</span> begin<span class="token punctuation">.</span>center<span class="token punctuation">,</span> radius<span class="token operator">:</span> radius<span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Ao criar a classe <code>HeroTween</code>, que estende <code>RectTween</code>, passamos um <code>begin</code> e um <code>end</code>. Essas propriedades são os retângulos (<code>Rect</code>s) ocupados pelo widget na tela de origem e de destino da animação. Assim, vamos interpolar entre o retângulo original (<code>begin</code>) e um retângulo que contenha um círculo cujo centro é o centro do original (<code>begin.center</code>) e o raio é a distância que calculamos no construtor.</p><p>A inicialização no construtor pode não parecer clara. O que ela está fazendo é calcular, para cada vértice do retângulo final (<code>end</code>), a diferênça entre o vértice e o centro do retângulo inicial (<code>begin</code>). O resultado dessa diferença é um <code>Offset</code>. A classe <code>Offset</code> já tem um <em>getter</em> que retorna a distância, <code>.distance</code>, porém ela também tem um <code>.distanceSquared</code> que é mais eficiente. Como não sabemos qual distância vamos usar, podemos usar a <code>.distanceSquared</code> para comparar e encontrar a maior primeiro, e só tirar a raiz quadrada da que realmente vamos usar, a maior.</p><p>Ao final da transição, a animação vai parar de renderizar nosso <code>flightShuttleBuilder</code> e desenhar o <code>child</code> do <code>Hero</code> de destino, que é a tela de sucesso. Ela já tem o fundo verde, o que ajuda na ilusão e cumpre o item 4 da lista acima. Como a transição entre as telas é feita usando o método <code>pushReplacement</code> do <code>Navigator</code>, a tela anterior não é mais acessível e, ao fazer um <code>pop</code>, não voltamos para a tela com o botão animado, mas sim para onde estávamos antes de tudo isso (cuprindo o item 5). Por essa razão, <strong>não temos que nos preocupar com o funcionamento da animação no sentido contrário</strong> e, por isso, não definimos esses atributos adicionais no <code>Hero</code> da tela de origem.</p><p><strong>Ufa!</strong> Se você chegou até aqui, dá uma respirada. Vimos bastante coisa de uma vez! Hero animations podem ser bem simples de usar, mas possuem mecanismos extra para quando queremos ir além do básico e criar animações para interações mais específicas e personalizadas. Dá uma olhada no código abaixo, ele é o código completo das duas telas da animação desse exemplo. Boa parte dele é referente à UI das duas telas, mas deixei uns comentários marcando as partes mais relevantes da nossa animação.</p><h3>Código-fonte do exemplo</h3><pre class="refractor language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">PurchaseScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  @override
  _PurchaseScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">_PurchaseScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">enum</span> PurchaseState <span class="token punctuation">{</span> waiting<span class="token punctuation">,</span> processing<span class="token punctuation">,</span> successful <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_PurchaseScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>PurchaseScreen<span class="token operator">&gt;</span>
    <span class="token keyword">with</span> TickerProviderStateMixin <span class="token punctuation">{</span>
  <span class="token comment">// Para controlar o estado do botão</span>
  PurchaseState purchaseState <span class="token operator">=</span> PurchaseState<span class="token punctuation">.</span>waiting<span class="token punctuation">;</span>

  @override
  Widget <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">BuildContext context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    final theme <span class="token operator">=</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    final headlineStyle <span class="token operator">=</span> theme<span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>headline4<span class="token punctuation">;</span>
    final labelStyle <span class="token operator">=</span> theme<span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>subtitle1<span class="token punctuation">;</span>
    final valueStyle <span class="token operator">=</span> labelStyle<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>fontWeight<span class="token operator">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token operator">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>title<span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;Review your purchase&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
        padding<span class="token operator">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        child<span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
          mainAxisAlignment<span class="token operator">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
          crossAxisAlignment<span class="token operator">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
          children<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>
              <span class="token string">&#x27;Pikachu pillow&#x27;</span><span class="token punctuation">,</span>
              style<span class="token operator">:</span> headlineStyle<span class="token punctuation">,</span>
              textAlign<span class="token operator">:</span> TextAlign<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
              <span class="token string">&#x27;https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png&#x27;</span><span class="token punctuation">,</span>
              width<span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
              fit<span class="token operator">:</span> BoxFit<span class="token punctuation">.</span>contain<span class="token punctuation">,</span>
              filterQuality<span class="token operator">:</span> FilterQuality<span class="token punctuation">.</span>none<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Column</span><span class="token punctuation">(</span>
              children<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token function">Row</span><span class="token punctuation">(</span>
                  mainAxisAlignment<span class="token operator">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>
                  children<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;Delivery estimate&#x27;</span><span class="token punctuation">,</span> style<span class="token operator">:</span> labelStyle<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;4 business days&#x27;</span><span class="token punctuation">,</span> style<span class="token operator">:</span> valueStyle<span class="token punctuation">)</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Row</span><span class="token punctuation">(</span>
                  mainAxisAlignment<span class="token operator">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>
                  children<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;Price&#x27;</span><span class="token punctuation">,</span> style<span class="token operator">:</span> labelStyle<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;\$ 30&#x27;</span><span class="token punctuation">,</span> style<span class="token operator">:</span> valueStyle<span class="token punctuation">)</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// O Hero da tela inicial, em volta do botão, sem propriedades além da tag e child</span>
            <span class="token function">Hero</span><span class="token punctuation">(</span>
              tag<span class="token operator">:</span> <span class="token string">&#x27;order-success&#x27;</span><span class="token punctuation">,</span>
              child<span class="token operator">:</span> <span class="token function">RawMaterialButton</span><span class="token punctuation">(</span>
                onPressed<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> async <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseState <span class="token operator">!=</span> PurchaseState<span class="token punctuation">.</span>waiting<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    purchaseState <span class="token operator">=</span> PurchaseState<span class="token punctuation">.</span>processing<span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token comment">// Simulando uma transação real com await em Future.delayed</span>
                  <span class="token keyword">await</span> Future<span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    purchaseState <span class="token operator">=</span> PurchaseState<span class="token punctuation">.</span>successful<span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token keyword">await</span> Future<span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token comment">// pushReplacement para não ser possível voltar para essa tela</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pushReplacement</span><span class="token punctuation">(</span><span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>
                    <span class="token function-variable function">builder</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">SuccessScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    fullscreenDialog<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// Os atributos iniciados em _ são getters definidos logo abaixo do build</span>
                fillColor<span class="token operator">:</span> _buttonColor<span class="token punctuation">,</span>
                shape<span class="token operator">:</span> _buttonShape<span class="token punctuation">,</span>
                child<span class="token operator">:</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>
                  height<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
                  child<span class="token operator">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token operator">:</span> _buttonChild<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Widget <span class="token keyword">get</span> _buttonChild <span class="token punctuation">{</span>
    final theme <span class="token operator">=</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    final themeContrastColor <span class="token operator">=</span> theme<span class="token punctuation">.</span>primaryTextTheme<span class="token punctuation">.</span>headline6<span class="token punctuation">.</span>color<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>purchaseState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>processing<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>successful<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>check<span class="token punctuation">,</span> color<span class="token operator">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>waiting<span class="token operator">:</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">Text</span><span class="token punctuation">(</span>
          <span class="token string">&#x27;PLACE ORDER&#x27;</span><span class="token punctuation">,</span>
          style<span class="token operator">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
            color<span class="token operator">:</span> themeContrastColor<span class="token punctuation">,</span>
            fontWeight<span class="token operator">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>
            fontSize<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  Color <span class="token keyword">get</span> _buttonColor <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>purchaseState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>processing<span class="token operator">:</span>
        <span class="token keyword">return</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>successful<span class="token operator">:</span>
        <span class="token keyword">return</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">;</span>

      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>waiting<span class="token operator">:</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>primaryColor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// A mudança do shape é animada pelo RawMaterialButton automaticamente</span>
  ShapeBorder <span class="token keyword">get</span> _buttonShape <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>purchaseState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>processing<span class="token operator">:</span>
      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>successful<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">CircleBorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> PurchaseState<span class="token punctuation">.</span>waiting<span class="token operator">:</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>borderRadius<span class="token operator">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="refractor language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">SuccessScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  @override
  Widget <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">BuildContext context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// O Hero aqui engloba a tela inteira e tem propriedades adicionais</span>
    <span class="token keyword">return</span> <span class="token function">Hero</span><span class="token punctuation">(</span>
      tag<span class="token operator">:</span> <span class="token string">&#x27;order-success&#x27;</span><span class="token punctuation">,</span>
      <span class="token comment">// Definindo como o widget vai aparecer durante a animação</span>
      flightShuttleBuilder<span class="token operator">:</span> <span class="token punctuation">(</span>flightContext<span class="token punctuation">,</span> animation<span class="token punctuation">,</span> flightDirection<span class="token punctuation">,</span>
          fromHeroContext<span class="token punctuation">,</span> toHeroContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          decoration<span class="token operator">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
            color<span class="token operator">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>
            shape<span class="token operator">:</span> BoxShape<span class="token punctuation">.</span>circle<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// Definindo o tamanho do widget durante a animação (a classe é criada abaixo desta)</span>
      createRectTween<span class="token operator">:</span> <span class="token punctuation">(</span>begin<span class="token punctuation">,</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">HeroTween</span><span class="token punctuation">(</span>begin<span class="token operator">:</span> begin<span class="token punctuation">,</span> end<span class="token operator">:</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      child<span class="token operator">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        backgroundColor<span class="token operator">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>
        body<span class="token operator">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>
          padding<span class="token operator">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          child<span class="token operator">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
            mainAxisAlignment<span class="token operator">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>
            crossAxisAlignment<span class="token operator">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
            children<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token function">Icon</span><span class="token punctuation">(</span>
                Icons<span class="token punctuation">.</span>shopping_basket<span class="token punctuation">,</span>
                color<span class="token operator">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                size<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Text</span><span class="token punctuation">(</span>
                <span class="token string">&#x27;Your order is on its way!&#x27;</span><span class="token punctuation">,</span>
                textAlign<span class="token operator">:</span> TextAlign<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                style<span class="token operator">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                  color<span class="token operator">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                  fontSize<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">RaisedButton</span><span class="token punctuation">(</span>
                onPressed<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  Navigator<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                child<span class="token operator">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&#x27;Got it&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// A classe usada pelo createRectTween</span>
<span class="token keyword">class</span> <span class="token class-name">HeroTween</span> <span class="token keyword">extends</span> <span class="token class-name">RectTween</span> <span class="token punctuation">{</span>
  <span class="token comment">// Calculando o raio no construtor</span>
  <span class="token function">HeroTween</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Rect begin<span class="token punctuation">,</span> Rect end<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> radius <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          end<span class="token punctuation">.</span>topLeft<span class="token punctuation">,</span>
          end<span class="token punctuation">.</span>topRight<span class="token punctuation">,</span>
          end<span class="token punctuation">.</span>bottomLeft<span class="token punctuation">,</span>
          end<span class="token punctuation">.</span>bottomRight
        <span class="token punctuation">]</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> begin<span class="token punctuation">.</span>center <span class="token operator">-</span> p<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>distanceSquared<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>begin<span class="token operator">:</span> begin<span class="token punctuation">,</span> end<span class="token operator">:</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>

  final double radius<span class="token punctuation">;</span>

  @override
  Rect <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token parameter">double t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">lerp</span><span class="token punctuation">(</span>
        begin<span class="token punctuation">,</span> Rect<span class="token punctuation">.</span><span class="token function">fromCircle</span><span class="token punctuation">(</span>center<span class="token operator">:</span> begin<span class="token punctuation">.</span>center<span class="token punctuation">,</span> radius<span class="token operator">:</span> radius<span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><hr/><div class="Poststyles__AfterPost-sc-12qb97v-0 tuaWG"><p class="Poststyles__AfterPostChild-sc-12qb97v-1 gkeqUt">Gostou? <a href="https://twitter.com/intent/tweet?text=%22De%20zero%20a%20heroi%3A%20Hero%20animations%20em%20Flutter%22%20por%20%40Cisneiros%0A%0Ahttps%3A%2F%2Fblog.cisne.dev%2Fde-zero-a-heroi-hero-animations-em-flutter" target="_blank" rel="noopener noreferrer">Que tal compartilhar?</a></p><p class="Poststyles__AfterPostChild-sc-12qb97v-1 Poststyles__Tags-sc-12qb97v-2 fAvgXR">Tags: <span class="Poststyles__Tag-sc-12qb97v-3 kSZCZX"><a href="/tag/flutter">flutter</a></span><span class="Poststyles__Tag-sc-12qb97v-3 kSZCZX"><a href="/tag/mobile">mobile</a></span></p></div></article></div></div></main><footer class="Footer__Container-b3q04c-0 gdHjSq"><div class="ui__Fit-prwz6b-0 Footer__FooterFit-b3q04c-1 layJcq"><p>© <a href="https://cisne.dev">Alexandre Cisneiros</a></p><p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA 4.0</a></p></div></footer></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/src/containers/post\",\"sharedHashesByProp\":{},\"data\":{\"postData\":{\"title\":\"De zero a heroi: Hero animations em Flutter\",\"date\":\"2020-08-31T00:00:00-03:00\",\"slug\":\"de-zero-a-heroi-hero-animations-em-flutter\",\"tags\":[\"flutter\",\"mobile\"],\"filePath\":\"2020-08-31-de-zero-a-heroi-hero-animations-em-flutter.md\",\"content\":\"Anima\u00E7\u00F5es s\u00E3o uma excelente maneira de tornar um app mais interativo e engajar os usu\u00E1rios. Flutter tem v\u00E1rias op\u00E7\u00F5es para criar anima\u00E7\u00F5es, com diferentes n\u00EDveis de complexididade. Uma das (se n\u00E3o a) mais simples s\u00E3o as **Hero animations**, que, com apenas um widget, permitem animar um componente durante a transi\u00E7\u00E3o entre duas telas. Vamos ver como fazer uma anima\u00E7\u00E3o super r\u00E1pida e explorar possibilidades mais avan\u00E7adas para criar anima\u00E7\u00F5es mais complexas com essa ferramenta.\\n\\n\u003C!-- summary-break -->\\n\\nAntes de come\u00E7ar, alguns exemplos de anima\u00E7\u00F5es que vamos implementar neste post:\\n\\n:::flex\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma imagem do Pok\u00E9mon Charizard e um bot\u00E3o para avan\u00E7ar para a pr\u00F3xima tela. Ao tocar no bot\u00E3o, uma transi\u00E7\u00E3o avan\u00E7a para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. Ao puxar com o dedo para voltar para a tela anterior, o Charizard acompanha a transi\u00E7\u00E3o. #autoplay#loop](/media/hero-3.mp4)\\n:::/phone-mockup\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma lista de Pok\u00E9mon, com n\u00FAmero, imagem e nome. Ao tocar no Charizard, uma nova tela de detalhes deste Pok\u00E9mon aparece a imagem e o n\u00FAmero dele voam da lista para essa nova tela. O mesmo acontece ao voltar para a lista e selecionar outro Pok\u00E9mon, o Blastoise. #autoplay#loop](/media/hero-4.mp4)\\n:::/phone-mockup\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma tela com detalhes de uma compra de uma almofada do Pok\u00E9mon Pikachu, com nome do produto, imagem, pre\u00E7o e data de entrega. Abaixo h\u00E1 um bot\u00E3o vermelho para finalizar a compra. Ao tocar nele, o bot\u00E3o fica cinza e o texto vira um indicador de carregamento. Ap\u00F3s um tempo, o bot\u00E3o fica verde e um \u00EDcone de sucesso aparece nele. Em seguida, o bot\u00E3o come\u00E7a a crescer at\u00E9 tomar a tela inteira, que fica toda verde. Aparece os textos da tela de sucesso da compra e um bot\u00E3o que, ao ser tocado, fecha e volta para o in\u00EDcio do app. #autoplay#loop](/media/hero-5.mp4)\\n:::/phone-mockup\\n\\n:::/flex\\n\\nTudo come\u00E7a com o widget `Hero`. Ele serve para identificar, nas telas de origem e destino da transi\u00E7\u00E3o, **qual \u00E9 o widget que vai ser animado**. Ele recebe um atributo `child` que \u00E9 o widget e um outro `tag`, que deve ser igual nas duas telas (isso permite ter mais de uma Hero animation ao mesmo tempo).\\n\\n```dart\\nHero(\\n  tag: 'charizard',\\n  child: Image.network('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png'),\\n)\\n```\\n\\n## Animando um widget durante uma transi\u00E7\u00E3o de telas\\n\\nNo exemplo acima, envolvemos um widget `Image` com um `Hero`. Agora, s\u00F3 precisamos colocar este `Hero` em duas telas e criar uma transi\u00E7\u00E3o entre elas.\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma imagem do Pok\u00E9mon Charizard e um bot\u00E3o para avan\u00E7ar para a pr\u00F3xima tela. Ao tocar no bot\u00E3o, uma transi\u00E7\u00E3o avan\u00E7a para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. #autoplay#loop](/media/hero-1.mp4)\\n:::/phone-mockup\\n\\n```dart\\nclass FirstScreen extends StatelessWidget {\\n  @override\\n  Widget build(BuildContext context) {\\n    return Scaffold(\\n      appBar: AppBar(\\n        title: Text('First screen'),\\n      ),\\n      body: Column(\\n        children: [\\n          // O Hero na primeira tela\\n          Hero(\\n            tag: 'charizard',\\n            child: Image.network(\\n                'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png'),\\n          ),\\n          RaisedButton(\\n            child: Text('Go to next screen'),\\n            onPressed: () {\\n              Navigator.of(context).push(\\n                MaterialPageRoute(builder: (_) => SecondScreen()),\\n              );\\n            },\\n          ),\\n        ],\\n      ),\\n    );\\n  }\\n}\\n\\nclass SecondScreen extends StatelessWidget {\\n  @override\\n  Widget build(BuildContext context) {\\n    return Scaffold(\\n      appBar: AppBar(\\n        title: Text('Second screen'),\\n      ),\\n      body: Center(\\n        // O mesmo Hero na segunda tela\\n        child: Hero(\\n          tag: 'charizard',\\n          child: Image.network(\\n              'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png'),\\n        ),\\n      ),\\n    );\\n  }\\n}\\n```\\n\\nE \u00E9 isso! Com apenas um widget em cada tela, temos essa anima\u00E7\u00E3o na transi\u00E7\u00E3o. Ela funciona tanto na ida como na volta e j\u00E1 d\u00E1 um efeito legal.\\n\\nEm algumas plataformas, como no iOS, \u00E9 costumeiro o usu\u00E1rio poder voltar para a tela anterior deslizando o dedo do canto da tela. Por padr\u00E3o, Hero animations **n\u00E3o v\u00E3o animar nesse tipo de trans\u00E7\u00E3o**. Se voc\u00EA quiser que anime, \u00E9 s\u00F3 adicionar o atributo `transitionOnUserGestures` nos dois `Hero`s, assim:\\n\\n```dart\\nHero(\\n  tag: 'charizard',\\n  transitionOnUserGestures: true, // O novo atributo\\n  child: Image.network('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png'),\\n)\\n```\\n\\nNos v\u00EDdeos abaixo, temos um exemplo de usu\u00E1rio arrastando a tela para voltar sem e com `transitionOnUserGestures`, respectivamente.\\n\\n:::flex\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma imagem do Pok\u00E9mon Charizard e um bot\u00E3o para avan\u00E7ar para a pr\u00F3xima tela. Ao tocar no bot\u00E3o, uma transi\u00E7\u00E3o avan\u00E7a para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. Ao puxar com o dedo para voltar para a tela anterior, o Charizard n\u00E3o acompanha a transi\u00E7\u00E3o, aparecendo separadamente nas duas telas. #autoplay#loop](/media/hero-2.mp4)\\n:::/phone-mockup\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma imagem do Pok\u00E9mon Charizard e um bot\u00E3o para avan\u00E7ar para a pr\u00F3xima tela. Ao tocar no bot\u00E3o, uma transi\u00E7\u00E3o avan\u00E7a para a segunda tela, mas o Charizard voa de uma tela par a outra, terminando no meio da segunda tela. Ao puxar com o dedo para voltar para a tela anterior, o Charizard acompanha a transi\u00E7\u00E3o. #autoplay#loop](/media/hero-3.mp4)\\n:::/phone-mockup\\n\\n:::/flex\\n\\nComo eu comentei antes, \u00E9 poss\u00EDvel ter mais de um `Hero` na mesma tela. E n\u00E3o necessariamente voc\u00EA precisa ter um correspondente nas duas telas, pois se uma transi\u00E7\u00E3o encontrar um `Hero` de um lado s\u00F3, ela n\u00E3o vai animar o elemento mas nenhum erro acontecer\u00E1. Podemos usar isso para fazer uma anima\u00E7\u00E3o dos elementos de uma lista para uma tela de detalhes.\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma lista de Pok\u00E9mon, com n\u00FAmero, imagem e nome. Ao tocar no Charizard, uma nova tela de detalhes deste Pok\u00E9mon aparece a imagem e o n\u00FAmero dele voam da lista para essa nova tela. O mesmo acontece ao voltar para a lista e selecionar outro Pok\u00E9mon, o Blastoise. #autoplay#loop](/media/hero-4.mp4)\\n:::/phone-mockup\\n\\nPara isso, precisamos apenas garantir que a `tag` vai ser **\u00FAnica entre os elementos** e que conseguimos **replic\u00E1-la na segunda tela**. Neste exemplo, vamos partir de uma classe `Pokemon` que tem um atributo `number`, \u00FAnico entre cada esp\u00E9cie de Pok\u00E9mon. Para montar a lista, usei um `SliverGrid` que serve para montar uma lista em formato de Grid dentro de um `CustomScrollView`. Como Slivers funcionam \u00E9 assunto pra outra conversa, mas o que \u00E9 relevante \u00E9 que ele recebe uma classe com um builder que, para cada item da lista, vai renderizar um widget.\\n\\n```dart\\nSliverChildBuilderDelegate((context, index) {\\n  final pokemon = pokedex.pokemonNumbered(index + 1);\\n\\n  return GestureDetector(\\n    onTap: () => toPokemonDetail(pokemon),\\n    child: Hero(\\n      tag: 'sprite-${pokemon.number}',\\n      transitionOnUserGestures: true,\\n      child: Image.network(pokemon.spriteUrl),\\n    ),\\n  );\\n})\\n```\\n\\nNa `tag`, vamos gerar uma string usando o n\u00FAmero do Pok\u00E9mon. Na tela de detalhe, s\u00F3 precisamos repetir a mesma `tag` e a Hero animation vai funcionar. Como a tela de detalhe recebe como par\u00E2metro o Pok\u00E9mon para exibir, ela tem o n\u00FAmero dele e pode criar um `Hero` com a mesma `tag`. Todos os outros `Hero`s na lista n\u00E3o v\u00E3o ter um correspondente na tela de detalhe, ent\u00E3o eles n\u00E3o ser\u00E3o animados.\\n\\nNo v\u00EDdeo do exemplo, eu coloquei um segundo `Hero` para animar o n\u00FAmero do Pok\u00E9mon, tamb\u00E9m. \u00C9 a mesma ideia, mas ao inv\u00E9s do `child` ser uma imagem, \u00E9 um texto. A `tag` precisa ser diferente, e por isso eu coloquei o prefixo \\\"sprite\\\" na `tag` do primeiro exemplo. Para o n\u00FAmero, voc\u00EA pode usar `'number-${pokemon.number}'`.\\n\\nNote que o estado inicial e final n\u00E3o precisam ter o mesmo tamanho. O `Hero` vai interpolar as dimens\u00F5es automaticamente. Na maioria dos casos, isso \u00E9 suficiente, mas existem maneiras de modificar o funcionamento das transi\u00E7\u00F5es. Isso \u00E9 particulamente interessante quando usamos uma Hero animation em que o estado inicial e final n\u00E3o s\u00E3o o mesmo widget, e eles podem ter filhos com layouts diferentes e que, se apenas interpolarmos as dimens\u00F5es, podemos ter comportamentos estranhos.\\n\\n## Redefinindo o comportamento de transi\u00E7\u00E3o\\n\\nVamos dar uma olhada num uso mais avan\u00E7ado do `Hero`. Nos exemplos anteriores, n\u00F3s apenas definimos o estado final e inicial. Nosso objetivo vai ser implementar uma anima\u00E7\u00E3o assim:\\n\\n:::phone-mockup\\n![V\u00EDdeo mostrando uma tela com detalhes de uma compra de uma almofada do Pok\u00E9mon Pikachu, com nome do produto, imagem, pre\u00E7o e data de entrega. Abaixo h\u00E1 um bot\u00E3o vermelho para finalizar a compra. Ao tocar nele, o bot\u00E3o fica cinza e o texto vira um indicador de carregamento. Ap\u00F3s um tempo, o bot\u00E3o fica verde e um \u00EDcone de sucesso aparece nele. Em seguida, o bot\u00E3o come\u00E7a a crescer at\u00E9 tomar a tela inteira, que fica toda verde. Aparece os textos da tela de sucesso da compra e um bot\u00E3o que, ao ser tocado, fecha e volta para o in\u00EDcio do app. #autoplay#loop](/media/hero-5.mp4)\\n:::/phone-mockup\\n\\nComo o c\u00F3digo-fonte desse exemplo \u00E9 um pouco maior, vou explicar alguns dos novos conceitos primeiro e depois colocar o c\u00F3digo completo do exemplo.\\n\\nSeparando em partes, o que acontece no exemplo \u00E9:\\n\\n1. Ao clicar no bot\u00E3o, ele diminui e mostra um indicador de carregamento.\\n2. Ap\u00F3s um tempo, ele fica verde e mostra um \u00EDcone de sucesso.\\n3. O bot\u00E3o expande e toma a tela inteira, deixando-a verde.\\n4. Uma mensagem de sucesso aparece na tela verde.\\n5. Ao tocar no bot\u00E3o que apareceu agora, a tela fecha.\\n\\nPara simular uma transa\u00E7\u00E3o, a tela \u00E9 um `StatefulWidget` que tem um atributo para guardar o seu estado. Ele pode ter o valor `waiting` (inicial), `processing` e `successful`. N\u00E3o h\u00E1 nenhuma comunica\u00E7\u00E3o real acontecendo, e a mudan\u00E7a entre estados acontece usando `await` em timers, quando o bot\u00E3o \u00E9 clicado.\\n\\n```dart\\nRawMaterialButton(\\n  onPressed: () async {\\n    if (purchaseState != PurchaseState.waiting) return;\\n\\n    setState(() {\\n      purchaseState = PurchaseState.processing;\\n    });\\n\\n    await Future.delayed(Duration(seconds: 2));\\n\\n    setState(() {\\n      purchaseState = PurchaseState.successful;\\n    });\\n\\n    await Future.delayed(Duration(milliseconds: 500));\\n\\n    await Navigator.of(context)\\n        .pushReplacement(MaterialPageRoute(\\n      builder: (_) => SuccessScreen(),\\n      fullscreenDialog: true,\\n    ));\\n  },\\n  fillColor: _buttonColor,\\n  shape: _buttonShape,\\n  child: SizedBox(\\n    height: 50,\\n    child: Center(child: _buttonChild),\\n  ),\\n)\\n```\\n\\nAs propriedades `_buttonColor`, `_buttonShape` e `_buttonChild` s\u00E3o _getters_ adicionados no widget que fazem um `switch/case` no estado e retornam a cor de fundo, formato e conte\u00FAdo do bot\u00E3o, respectivamente.\\n\\nOs \u00EDtens 1 e 2 da lista s\u00E3o presentes do `RawMaterialButton`, uma classe base para criar bot\u00F5es no Material Design. O bot\u00E3o mudar de um formato de p\u00EDlula para um c\u00EDrculo acontece pois mudamos o seu atributo `Shape`. O `RawMaterialButton` anima essa mudan\u00E7a de formato automaticamente.\\n\\nO item 3, a expans\u00E3o do bot\u00E3o at\u00E9 tomar a tela toda, que \u00E9 o nosso foco. Ele \u00E9 uma Hero animation. Pode n\u00E3o parecer \u00F3bvio pois, ao clicar, n\u00E3o vemos uma nova tela abrindo e um widget voando da tela antiga para a nova. O segredo \u00E9 que o widget de destino \u00E9 **a tela nova inteira**. Na tela de origem, o `Hero` est\u00E1 em volta do bot\u00E3o. J\u00E1 na tela de destino, o `Hero` est\u00E1 em volta da tela toda. Isso faz com que o bot\u00E3o se transforme na tela seguinte inteira.\\n\\nSe voc\u00EA olhar no c\u00F3digo-fonte do exemplo, que est\u00E1 todo na pr\u00F3xima se\u00E7\u00E3o, vai notar que o `Hero` da tela de destino \u00E9 um pouco diferente dos que fizemos at\u00E9 agora (al\u00E9m do fato de ele englobar uma tela inteira). Ele tem dois atributos que n\u00E3o usamos ainda: `flightShuttleBuilder` e `createRectTween`. Precisamos desses dois atributos para deixar o efeito com a cara que ficou.\\n\\nCome\u00E7ando pelo `flightShuttleBuilder`, ele serve para definir **como renderizar o widget durante a transi\u00E7\u00E3o**. Por padr\u00E3o, o pr\u00F3prio widget \u00E9 usado na transi\u00E7\u00E3o (nos exemplos dos Pok\u00E9mon, n\u00F3s vemos a sprite ele se mover de uma tela para a outra). Por\u00E9m, neste caso, o bot\u00E3o come\u00E7a bem pequeno e cresce at\u00E9 ocupar a tela toda. Por\u00E9m, o widget da tela em si possui textos e outros elementos grandes, que dependem do espa\u00E7o dispon\u00EDvel para que seu layout seja calculado. Durante a transi\u00E7\u00E3o (e expans\u00E3o), esse espa\u00E7o vai ser insuficiente e vamos ter problemas de overflow.\\n\\nH\u00E1 mais de uma maneira de resolver isso, mas eu parti para uma bem simples: durante a transi\u00E7\u00E3o, vamos renderizar o widget apenas como um c\u00EDrculo verde expandindo. Ele j\u00E1 vai come\u00E7ar como um c\u00EDrculo verde, no sucesso da compra, e vai expandir com um raio que, garantidamente, vai preencher a tela inteira.\\n\\n```dart\\nHero(\\n  // ...\\n  flightShuttleBuilder: (flightContext, animation, flightDirection,\\n      fromHeroContext, toHeroContext) {\\n    return Container(\\n      decoration: BoxDecoration(\\n        color: Colors.green,\\n        shape: BoxShape.circle,\\n      ),\\n    );\\n  },\\n)\\n```\\n\\nO `flightShuttleBuilder` recebe cinco par\u00E2metros, que deixei expl\u00EDcitos no exemplo acima para ilustrar suas exist\u00EAncias. N\u00E3o precisamos deles pois vamos renderizar, em todos os quadros da anima\u00E7\u00E3o, o mesmo c\u00EDrculo verde. Mas temos acesso ao contexto das telas originais e finais, da transi\u00E7\u00E3o, a dire\u00E7\u00E3o dessa transi\u00E7\u00E3o e, talvez mais interessante, a `animation` em si. Ela pode ser usada para modificar o widget durante a transi\u00E7\u00E3o de acordo com o progresso da anima\u00E7\u00E3o (que estar\u00E1 em `animation.value`, de zero a um).\\n\\nEu comentei acima sobre **garantir que o raio do c\u00EDrculo vai cubrir a tela inteira**. O `flightShuttleBuilder` acima n\u00E3o tem nada sobre isso. Para isso vamos usar a outra nova propriedade: `createRectTween`. Ela serve para definir a \u00E1rea e a posi\u00E7\u00E3o ocupadas pelo widget durante a transi\u00E7\u00E3o. Quando n\u00E3o definimos essa propriedade, por padr\u00E3o a Hero animation vai desenhar o widget num ret\u00E2ngulo onde o `Hero` estava na primeira tela e interpolar at\u00E9 o ret\u00E2ngulo em que o `Hero` est\u00E1 na segunda tela. Ou seja, o widget original aparenta se mover e mudar de tamanho para se transformar nas dimens\u00F5es da tela de destino.\\n\\nPara a anima\u00E7\u00E3o que queria fazer, meu objetivo era que o c\u00EDrculo expandisse **sem sair do lugar**, ou seja, **sem mudar seu centro**. Para isso, precisava que o ret\u00E2ngulo de origem e destino tivessem o mesmo centro, e que o ret\u00E2ngulo de destino crescesse o suficiente para que o c\u00EDrculo do nosso `flightShuttleBuilder` cobrisse a tela inteira. Flutter j\u00E1 tem maneiras de interpolar dois ret\u00E2ngulos (com `Rect.lerp()`), ent\u00E3o eu preciso apenas definir quais s\u00E3o os ret\u00E2ngulos inicial e final.\\n\\nO ret\u00E2ngulo inicial \u00E9 o pr\u00F3prio bot\u00E3o. Ele convenientemente j\u00E1 \u00E9 um quadrado que tem um c\u00EDrculo verde dentro (o bot\u00E3o). J\u00E1 o ret\u00E2ngulo final precisa **conter um c\u00EDrculo que contenha a tela inteira**. Isso \u00E9 meio confuso, mas a ideia \u00E9 que o raio do c\u00EDrculo precisa ser a **dist\u00E2ncia entre o centro do c\u00EDrculo e o canto da tela mais longe dele**. \u00C9 isso que vamos calcular no construtor da classe `HeroTween`, abaixo. Fazemos isso no construtor pois os ret\u00E2ngulos inicial e final n\u00E3o mudam durante a anima\u00E7\u00E3o.\\n\\n```dart\\nHero(\\n  // ...\\n  createRectTween: (begin, end) {\\n    return HeroTween(begin: begin, end: end);\\n  },\\n)\\n\\n// ...\\n\\nclass HeroTween extends RectTween {\\n  HeroTween({Rect begin, Rect end})\\n      : radius = sqrt([\\n          end.topLeft,\\n          end.topRight,\\n          end.bottomLeft,\\n          end.bottomRight\\n        ]\\n            .map((p) => begin.center - p)\\n            .map((o) => o.distanceSquared)\\n            .reduce(max)),\\n        super(begin: begin, end: end);\\n\\n  final double radius;\\n\\n  @override\\n  Rect lerp(double t) {\\n    return Rect.lerp(\\n        begin, Rect.fromCircle(center: begin.center, radius: radius), t);\\n  }\\n}\\n```\\n\\nAo criar a classe `HeroTween`, que estende `RectTween`, passamos um `begin` e um `end`. Essas propriedades s\u00E3o os ret\u00E2ngulos (`Rect`s) ocupados pelo widget na tela de origem e de destino da anima\u00E7\u00E3o. Assim, vamos interpolar entre o ret\u00E2ngulo original (`begin`) e um ret\u00E2ngulo que contenha um c\u00EDrculo cujo centro \u00E9 o centro do original (`begin.center`) e o raio \u00E9 a dist\u00E2ncia que calculamos no construtor.\\n\\nA inicializa\u00E7\u00E3o no construtor pode n\u00E3o parecer clara. O que ela est\u00E1 fazendo \u00E9 calcular, para cada v\u00E9rtice do ret\u00E2ngulo final (`end`), a difer\u00EAn\u00E7a entre o v\u00E9rtice e o centro do ret\u00E2ngulo inicial (`begin`). O resultado dessa diferen\u00E7a \u00E9 um `Offset`. A classe `Offset` j\u00E1 tem um _getter_ que retorna a dist\u00E2ncia, `.distance`, por\u00E9m ela tamb\u00E9m tem um `.distanceSquared` que \u00E9 mais eficiente. Como n\u00E3o sabemos qual dist\u00E2ncia vamos usar, podemos usar a `.distanceSquared` para comparar e encontrar a maior primeiro, e s\u00F3 tirar a raiz quadrada da que realmente vamos usar, a maior.\\n\\nAo final da transi\u00E7\u00E3o, a anima\u00E7\u00E3o vai parar de renderizar nosso `flightShuttleBuilder` e desenhar o `child` do `Hero` de destino, que \u00E9 a tela de sucesso. Ela j\u00E1 tem o fundo verde, o que ajuda na ilus\u00E3o e cumpre o item 4 da lista acima. Como a transi\u00E7\u00E3o entre as telas \u00E9 feita usando o m\u00E9todo `pushReplacement` do `Navigator`, a tela anterior n\u00E3o \u00E9 mais acess\u00EDvel e, ao fazer um `pop`, n\u00E3o voltamos para a tela com o bot\u00E3o animado, mas sim para onde est\u00E1vamos antes de tudo isso (cuprindo o item 5). Por essa raz\u00E3o, **n\u00E3o temos que nos preocupar com o funcionamento da anima\u00E7\u00E3o no sentido contr\u00E1rio** e, por isso, n\u00E3o definimos esses atributos adicionais no `Hero` da tela de origem.\\n\\n**Ufa!** Se voc\u00EA chegou at\u00E9 aqui, d\u00E1 uma respirada. Vimos bastante coisa de uma vez! Hero animations podem ser bem simples de usar, mas possuem mecanismos extra para quando queremos ir al\u00E9m do b\u00E1sico e criar anima\u00E7\u00F5es para intera\u00E7\u00F5es mais espec\u00EDficas e personalizadas. D\u00E1 uma olhada no c\u00F3digo abaixo, ele \u00E9 o c\u00F3digo completo das duas telas da anima\u00E7\u00E3o desse exemplo. Boa parte dele \u00E9 referente \u00E0 UI das duas telas, mas deixei uns coment\u00E1rios marcando as partes mais relevantes da nossa anima\u00E7\u00E3o.\\n\\n### C\u00F3digo-fonte do exemplo\\n\\n```dart\\nclass PurchaseScreen extends StatefulWidget {\\n  @override\\n  _PurchaseScreenState createState() => _PurchaseScreenState();\\n}\\n\\nenum PurchaseState { waiting, processing, successful }\\n\\nclass _PurchaseScreenState extends State<PurchaseScreen>\\n    with TickerProviderStateMixin {\\n  // Para controlar o estado do bot\u00E3o\\n  PurchaseState purchaseState = PurchaseState.waiting;\\n\\n  @override\\n  Widget build(BuildContext context) {\\n    final theme = Theme.of(context);\\n    final headlineStyle = theme.textTheme.headline4;\\n    final labelStyle = theme.textTheme.subtitle1;\\n    final valueStyle = labelStyle.copyWith(fontWeight: FontWeight.w500);\\n\\n    return Scaffold(\\n      appBar: AppBar(title: Text('Review your purchase')),\\n      body: Padding(\\n        padding: const EdgeInsets.all(8),\\n        child: Column(\\n          mainAxisAlignment: MainAxisAlignment.spaceEvenly,\\n          crossAxisAlignment: CrossAxisAlignment.center,\\n          children: [\\n            Text(\\n              'Pikachu pillow',\\n              style: headlineStyle,\\n              textAlign: TextAlign.center,\\n            ),\\n            Image.network(\\n              'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png',\\n              width: 250,\\n              fit: BoxFit.contain,\\n              filterQuality: FilterQuality.none,\\n            ),\\n            Column(\\n              children: [\\n                Row(\\n                  mainAxisAlignment: MainAxisAlignment.spaceBetween,\\n                  children: [\\n                    Text('Delivery estimate', style: labelStyle),\\n                    Text('4 business days', style: valueStyle)\\n                  ],\\n                ),\\n                Row(\\n                  mainAxisAlignment: MainAxisAlignment.spaceBetween,\\n                  children: [\\n                    Text('Price', style: labelStyle),\\n                    Text('\\\\$ 30', style: valueStyle)\\n                  ],\\n                ),\\n              ],\\n            ),\\n            // O Hero da tela inicial, em volta do bot\u00E3o, sem propriedades al\u00E9m da tag e child\\n            Hero(\\n              tag: 'order-success',\\n              child: RawMaterialButton(\\n                onPressed: () async {\\n                  if (purchaseState != PurchaseState.waiting) return;\\n\\n                  setState(() {\\n                    purchaseState = PurchaseState.processing;\\n                  });\\n\\n                  // Simulando uma transa\u00E7\u00E3o real com await em Future.delayed\\n                  await Future.delayed(Duration(seconds: 2));\\n\\n                  setState(() {\\n                    purchaseState = PurchaseState.successful;\\n                  });\\n\\n                  await Future.delayed(Duration(milliseconds: 500));\\n\\n                  // pushReplacement para n\u00E3o ser poss\u00EDvel voltar para essa tela\\n                  Navigator.of(context).pushReplacement(MaterialPageRoute(\\n                    builder: (_) => SuccessScreen(),\\n                    fullscreenDialog: true,\\n                  ));\\n                },\\n                // Os atributos iniciados em _ s\u00E3o getters definidos logo abaixo do build\\n                fillColor: _buttonColor,\\n                shape: _buttonShape,\\n                child: SizedBox(\\n                  height: 50,\\n                  child: Center(child: _buttonChild),\\n                ),\\n              ),\\n            ),\\n          ],\\n        ),\\n      ),\\n    );\\n  }\\n\\n  Widget get _buttonChild {\\n    final theme = Theme.of(context);\\n    final themeContrastColor = theme.primaryTextTheme.headline6.color;\\n\\n    switch (purchaseState) {\\n      case PurchaseState.processing:\\n        return CircularProgressIndicator();\\n\\n      case PurchaseState.successful:\\n        return Icon(Icons.check, color: Colors.white);\\n\\n      case PurchaseState.waiting:\\n      default:\\n        return Text(\\n          'PLACE ORDER',\\n          style: TextStyle(\\n            color: themeContrastColor,\\n            fontWeight: FontWeight.w500,\\n            fontSize: 24,\\n          ),\\n        );\\n    }\\n  }\\n\\n  Color get _buttonColor {\\n    switch (purchaseState) {\\n      case PurchaseState.processing:\\n        return Colors.grey[200];\\n\\n      case PurchaseState.successful:\\n        return Colors.green;\\n\\n      case PurchaseState.waiting:\\n      default:\\n        return Theme.of(context).primaryColor;\\n    }\\n  }\\n\\n  // A mudan\u00E7a do shape \u00E9 animada pelo RawMaterialButton automaticamente\\n  ShapeBorder get _buttonShape {\\n    switch (purchaseState) {\\n      case PurchaseState.processing:\\n      case PurchaseState.successful:\\n        return CircleBorder();\\n\\n      case PurchaseState.waiting:\\n      default:\\n        return RoundedRectangleBorder(borderRadius: BorderRadius.circular(25));\\n    }\\n  }\\n}\\n```\\n\\n```dart\\nclass SuccessScreen extends StatelessWidget {\\n  @override\\n  Widget build(BuildContext context) {\\n    // O Hero aqui engloba a tela inteira e tem propriedades adicionais\\n    return Hero(\\n      tag: 'order-success',\\n      // Definindo como o widget vai aparecer durante a anima\u00E7\u00E3o\\n      flightShuttleBuilder: (flightContext, animation, flightDirection,\\n          fromHeroContext, toHeroContext) {\\n        return Container(\\n          decoration: BoxDecoration(\\n            color: Colors.green,\\n            shape: BoxShape.circle,\\n          ),\\n        );\\n      },\\n      // Definindo o tamanho do widget durante a anima\u00E7\u00E3o (a classe \u00E9 criada abaixo desta)\\n      createRectTween: (begin, end) {\\n        return HeroTween(begin: begin, end: end);\\n      },\\n      child: Scaffold(\\n        backgroundColor: Colors.green,\\n        body: Padding(\\n          padding: const EdgeInsets.all(8),\\n          child: Column(\\n            mainAxisAlignment: MainAxisAlignment.spaceEvenly,\\n            crossAxisAlignment: CrossAxisAlignment.center,\\n            children: [\\n              Icon(\\n                Icons.shopping_basket,\\n                color: Colors.white,\\n                size: 200,\\n              ),\\n              Text(\\n                'Your order is on its way!',\\n                textAlign: TextAlign.center,\\n                style: TextStyle(\\n                  color: Colors.white,\\n                  fontSize: 40,\\n                ),\\n              ),\\n              RaisedButton(\\n                onPressed: () {\\n                  Navigator.of(context).pop();\\n                },\\n                child: Text('Got it'),\\n              )\\n            ],\\n          ),\\n        ),\\n      ),\\n    );\\n  }\\n}\\n\\n// A classe usada pelo createRectTween\\nclass HeroTween extends RectTween {\\n  // Calculando o raio no construtor\\n  HeroTween({Rect begin, Rect end})\\n      : radius = sqrt([\\n          end.topLeft,\\n          end.topRight,\\n          end.bottomLeft,\\n          end.bottomRight\\n        ]\\n            .map((p) => begin.center - p)\\n            .map((o) => o.distanceSquared)\\n            .reduce(max)),\\n        super(begin: begin, end: end);\\n\\n  final double radius;\\n\\n  @override\\n  Rect lerp(double t) {\\n    return Rect.lerp(\\n        begin, Rect.fromCircle(center: begin.center, radius: radius), t);\\n  }\\n}\\n```\\n\",\"readingTime\":17,\"summary\":\"Anima\u00E7\u00F5es s\u00E3o uma excelente maneira de tornar um app mais interativo e engajar os usu\u00E1rios. Flutter tem v\u00E1rias op\u00E7\u00F5es para criar anima\u00E7\u00F5es, com diferentes n\u00EDveis de complexididade. Uma das (se n\u00E3o a) mais simples s\u00E3o as **Hero animations**, que, com apenas um widget, permitem animar um componente durante a transi\u00E7\u00E3o entre duas telas. Vamos ver como fazer uma anima\u00E7\u00E3o super r\u00E1pida e explorar possibilidades mais avan\u00E7adas para criar anima\u00E7\u00F5es mais complexas com essa ferramenta.\\n\\n\"}},\"path\":\"de-zero-a-heroi-hero-animations-em-flutter\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/vendors~__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.207edc50.js"></script><script defer="" type="text/javascript" src="/templates/__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.a04ea84b.js"></script><script defer="" type="text/javascript" src="/templates/__react_static_root__/src/containers/post.d8dd52db.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.272ae1d1.js"></script><script defer="" type="text/javascript" src="/main.f19d4c14.js"></script></body></html>