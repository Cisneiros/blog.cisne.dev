<!DOCTYPE html><html lang="pt-BR" class=" "><head><meta name="generator" content="React Static"/><title data-react-helmet="true">Animações em JavaScript a 60 fps · Cisne.dev blog</title><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="Cisneiros"/><meta data-react-helmet="true" property="og:title" content="Animações em JavaScript a 60 fps · Cisne.dev blog"/><meta data-react-helmet="true" property="og:image" content="https://blog.cisne.dev/animacoes-em-javascript-a-60-fps/social-image.png"/><meta data-react-helmet="true" name="twitter:title" content="Animações em JavaScript a 60 fps · Cisne.dev blog"/><meta data-react-helmet="true" name="twitter:image" content="https://blog.cisne.dev/animacoes-em-javascript-a-60-fps/social-image.png"/><link rel="preload" as="script" href="/templates/vendors~__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.207edc50.js"/><link rel="preload" as="script" href="/templates/__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.a04ea84b.js"/><link rel="preload" as="script" href="/templates/__react_static_root__/src/containers/post.d8dd52db.js"/><link rel="preload" as="script" href="/templates/vendors~main.272ae1d1.js"/><link rel="preload" as="script" href="/main.f19d4c14.js"/><link data-react-helmet="true" rel="stylesheet" href="//unpkg.com/dracula-prism/dist/css/dracula-prism.min.css"/><style data-styled="" data-styled-version="5.1.1">.CfxHf{max-width:960px;margin:0 auto;position:relative;}/*!sc*/
data-styled.g1[id="ui__Fit-prwz6b-0"]{content:"CfxHf,"}/*!sc*/
.iuDFSN{padding:1rem;color:var(--color-mid);text-align:center;font-size:1.5rem;}/*!sc*/
.iuDFSN a,.iuDFSN a:hover{-webkit-text-decoration:none;text-decoration:none;color:inherit;}/*!sc*/
data-styled.g2[id="Navigation__Container-sc-1yk0pqp-0"]{content:"iuDFSN,"}/*!sc*/
.izuwCZ{max-width:960px;margin:0 auto;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g3[id="Navigation__NavFit-sc-1yk0pqp-1"]{content:"izuwCZ,"}/*!sc*/
.TctaC{width:2.5rem;height:1.2em;overflow:hidden;--default-rotation:-180deg;}/*!sc*/
@media (prefers-color-scheme:dark){.TctaC{--default-rotation:0;}}/*!sc*/
data-styled.g4[id="Navigation__BrightnessContainer-sc-1yk0pqp-2"]{content:"TctaC,"}/*!sc*/
.sLeDt{-webkit-transform:rotate(var(--default-rotation));-ms-transform:rotate(var(--default-rotation));transform:rotate(var(--default-rotation));-webkit-transition:-webkit-transform 0.3s ease-out;-webkit-transition:transform 0.3s ease-out;transition:transform 0.3s ease-out;}/*!sc*/
html.light .sLeDt{-webkit-transform:rotate(-180deg);-ms-transform:rotate(-180deg);transform:rotate(-180deg);}/*!sc*/
html.dark .sLeDt{-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);}/*!sc*/
data-styled.g5[id="Navigation__BrightnessSpinner-sc-1yk0pqp-3"]{content:"sLeDt,"}/*!sc*/
.frsARl{background:none;border:none;cursor:pointer;}/*!sc*/
.frsARl:last-child{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg);}/*!sc*/
data-styled.g7[id="Navigation__BrightnessIcon-sc-1yk0pqp-5"]{content:"frsARl,"}/*!sc*/
.gdHjSq{margin-top:3rem;padding:1rem;background:var(--color-foreground);color:var(--color-background);}/*!sc*/
.gdHjSq a{color:var(--text-inverse-color-1);}/*!sc*/
.gdHjSq a:hover{color:var(--text-inverse-color-3);}/*!sc*/
data-styled.g8[id="Footer__Container-b3q04c-0"]{content:"gdHjSq,"}/*!sc*/
.layJcq{max-width:960px;margin:0 auto;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g9[id="Footer__FooterFit-b3q04c-1"]{content:"layJcq,"}/*!sc*/
*{box-sizing:border-box;margin:0;padding:0;border:0;font-size:inherit;font-weight:inherit;font-style:inherit;}/*!sc*/
:root{--color-1:#12c2e9;--color-2:#c471ed;--color-3:#f64f59;--color-1-darker:#0A7B94;--color-2-darker:#AE3CE7;--color-3-darker:#E90C1B;--color-light:#fefefe;--color-dark:#030303;--color-mid-dark:#747481;--color-mid-light:#818181;--font-weight-light:300;--font-weight-regular:400;--font-weight-heavy:500;--font-family-light:"HelveticaNeue-Light","Helvetica Neue Light",'Helvetica Neue',sans-serif;--font-family:'Helvetica Neue',sans-serif;}/*!sc*/
strong,h1,h2,h3,h4,h5,h6{font-family:var(--font-family);}/*!sc*/
html{font-family:var(--font-family-light);font-size:20px;line-height:1;color:var(--color-foreground);background-color:var(--color-background);text-rendering:optimizeLegibility;}/*!sc*/
@media (max-width:600px){html{font-size:16px;}}/*!sc*/
html,html.light{--color-background:var(--color-light);--color-foreground:var(--color-dark);--color-mid:var(--color-mid-dark);--text-color-1:var(--color-1-darker);--text-color-2:var(--color-2-darker);--text-color-3:var(--color-3-darker);--text-inverse-color-1:var(--color-1);--text-inverse-color-2:var(--color-2);--text-inverse-color-3:var(--color-3);}/*!sc*/
html.dark{--color-background:var(--color-dark);--color-foreground:var(--color-light);--color-mid:var(--color-mid-light);--text-color-1:var(--color-1);--text-color-2:var(--color-2);--text-color-3:var(--color-3);--text-inverse-color-1:var(--color-1-darker);--text-inverse-color-2:var(--color-2-darker);--text-inverse-color-3:var(--color-3-darker);}/*!sc*/
@media (prefers-color-scheme:dark){html{--color-background:var(--color-dark);--color-foreground:var(--color-light);--color-mid:var(--color-mid-light);}}/*!sc*/
body{font-size:1em;font-weight:var(--font-weight-light);}/*!sc*/
strong{font-weight:var(--font-weight-heavy);}/*!sc*/
em{font-style:italic;}/*!sc*/
main{padding:1rem;}/*!sc*/
hr{width:30%;margin:4rem auto;border:none;border-bottom:dotted 1px var(--color-1);}/*!sc*/
.pagination{text-align:center;}/*!sc*/
.pagination a{color:var(--text-color-1);}/*!sc*/
.pagination a:hover{color:var(--text-color-3);}/*!sc*/
a{color:var(--text-color-1);-webkit-text-decoration-color:#c471ed80;text-decoration-color:#c471ed80;-webkit-text-decoration-style:wavy;text-decoration-style:wavy;}/*!sc*/
a:hover{color:var(--text-color-3);-webkit-text-decoration-color:#12c2e980;text-decoration-color:#12c2e980;}/*!sc*/
.phone-mockup{max-width:15rem;margin:0 auto 1rem;position:relative;}/*!sc*/
.phone-mockup::before{content:'';width:100%;height:100%;position:absolute;pointer-events:none;background:url(/iphone-11-pro.png) no-repeat;background-size:contain;}/*!sc*/
.phone-mockup video,.phone-mockup img{width:100%;padding:9.3%;}/*!sc*/
data-styled.g14[id="sc-global-hFBrmQ1"]{content:"sc-global-hFBrmQ1,"}/*!sc*/
.jLFdFk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
.jLFdFk .sources{width:100%;min-width:0;}/*!sc*/
.jLFdFk .result{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;max-width:30%;margin-left:2rem;}/*!sc*/
.jLFdFk.result-first{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}/*!sc*/
.jLFdFk.result-first .result{-webkit-order:0;-ms-flex-order:0;order:0;margin:0 0 1rem;max-width:initial;}/*!sc*/
.jLFdFk.result-first .sources{-webkit-order:1;-ms-flex-order:1;order:1;}/*!sc*/
@media (max-width:600px){.jLFdFk{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.jLFdFk .result{max-width:initial;margin-left:0;margin-top:1rem;}}/*!sc*/
data-styled.g16[id="MarkdownRendererstyles__LiveCodeContainer-i4h55e-1"]{content:"jLFdFk,"}/*!sc*/
.jcbAWj{margin-bottom:1rem;background:var(--color-1);color:var(--color-light);border:none;cursor:pointer;padding:0.5em;}/*!sc*/
.jcbAWj:hover{background:var(--color-3);-webkit-text-decoration-color:#12c2e980;text-decoration-color:#12c2e980;}/*!sc*/
data-styled.g17[id="MarkdownRendererstyles__RunScriptButton-i4h55e-2"]{content:"jcbAWj,"}/*!sc*/
.dfdSCV #example-1{width:200px;min-height:200px;}/*!sc*/
.cnLVdW #example-2{width:200px;min-height:200px;}/*!sc*/
data-styled.g22[id="MarkdownRenderer___StyledHtmlContainer-sc-185v3us-0"]{content:"dfdSCV,cnLVdW,"}/*!sc*/
.tuaWG{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
@media (max-width:600px){.tuaWG{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}/*!sc*/
data-styled.g23[id="Poststyles__AfterPost-sc-12qb97v-0"]{content:"tuaWG,"}/*!sc*/
.gkeqUt{-webkit-flex:1;-ms-flex:1;flex:1;}/*!sc*/
@media (max-width:600px){.gkeqUt{text-align:center;margin-bottom:1rem;}}/*!sc*/
data-styled.g24[id="Poststyles__AfterPostChild-sc-12qb97v-1"]{content:"gkeqUt,"}/*!sc*/
.fAvgXR{-webkit-flex:1;-ms-flex:1;flex:1;text-align:right;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}/*!sc*/
@media (max-width:600px){.fAvgXR{text-align:center;margin-bottom:1rem;}}/*!sc*/
data-styled.g25[id="Poststyles__Tags-sc-12qb97v-2"]{content:"fAvgXR,"}/*!sc*/
.kSZCZX::before{content:' #';color:var(--color-mid);}/*!sc*/
data-styled.g26[id="Poststyles__Tag-sc-12qb97v-3"]{content:"kSZCZX,"}/*!sc*/
.kyWzPB{-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;}/*!sc*/
data-styled.g27[id="Poststyles__Container-sc-12qb97v-4"]{content:"kyWzPB,"}/*!sc*/
.hhBwVH{font-size:5rem;font-weight:var(--font-weight-regular);line-height:0.8;background:linear-gradient(var(--color-1),var(--color-2),var(--color-3));-webkit-text-fill-color:transparent;background-clip:text;-webkit-background-clip:text;padding-bottom:1rem;margin:1rem 0;}/*!sc*/
html.rainbow .hhBwVH{background-image:linear-gradient(124deg,#ff2400,#e81d1d,#e8b71d,#e3e81d,#1de840,#1ddde8,#2b1de8,#dd00f3,#dd00f3);-webkit-animation:hTUzwZ 9s ease infinite;animation:hTUzwZ 9s ease infinite;background-size:450% 450%;}/*!sc*/
@media (max-width:600px){.hhBwVH{font-size:3.5rem;}}/*!sc*/
.hhBwVH a{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g28[id="Poststyles__Title-sc-12qb97v-5"]{content:"hhBwVH,"}/*!sc*/
.fonWHZ{color:var(--color-mid);text-align:center;margin-bottom:2rem;}/*!sc*/
data-styled.g29[id="Poststyles__Meta-sc-12qb97v-6"]{content:"fonWHZ,"}/*!sc*/
.jhgzPU{line-height:1.6;}/*!sc*/
.jhgzPU h2{font-size:2.5rem;}/*!sc*/
.jhgzPU h3{font-size:2rem;}/*!sc*/
.jhgzPU h4{font-size:1.5rem;}/*!sc*/
.jhgzPU h2,.jhgzPU h3,.jhgzPU h4,.jhgzPU h5,.jhgzPU h6{-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;font-weight:var(--font-weight-regular);line-height:0.8;padding-bottom:1rem;margin-top:2rem;}/*!sc*/
.jhgzPU img{max-width:100%;}/*!sc*/
.jhgzPU pre.refractor{margin-top:0;margin-left:0;padding-left:1rem;border-left:solid 0.25rem var(--color-1);border-radius:0;font-size:0.8rem;overflow-wrap:normal;overflow-x:auto;background-color:var(--color-dark);color:var(--color-light);padding-top:0.5rem;padding-bottom:0.5rem;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}/*!sc*/
.jhgzPU pre.refractor::-webkit-scrollbar{width:0.25rem;height:0.25rem;}/*!sc*/
.jhgzPU pre.refractor code,.jhgzPU code{font-family:'Fira Code','Menlo',monospace;}/*!sc*/
.jhgzPU p code{color:var(--text-color-3);}/*!sc*/
.jhgzPU p code,.jhgzPU h1 code,.jhgzPU h2 code,.jhgzPU h3 code,.jhgzPU h4 code,.jhgzPU h5 code,.jhgzPU h6 code{font-size:0.9em;}/*!sc*/
.jhgzPU p,.jhgzPU pre,.jhgzPU ul,.jhgzPU ol,.jhgzPU table,.jhgzPU blockquote,.jhgzPU .live-code-container{margin-bottom:1rem;}/*!sc*/
.jhgzPU twitter-widget{margin-bottom:1rem !important;}/*!sc*/
.jhgzPU p:last-child,.jhgzPU pre:last-child,.jhgzPU ul:last-child,.jhgzPU ol:last-child,.jhgzPU table:last-child,.jhgzPU blockquote:last-child,.jhgzPU .live-code-container:last-child{margin-bottom:0;}/*!sc*/
.jhgzPU ul,.jhgzPU ol{list-style:none;margin-left:1rem;counter-reset:li;}/*!sc*/
.jhgzPU li{counter-increment:li;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
.jhgzPU ul li::before{content:'•';margin-right:0.5rem;color:var(--color-2);}/*!sc*/
.jhgzPU ol li::before{content:"."counter(li);margin-right:0.5rem;color:var(--color-2);font-weight:var(--font-weight-regular);width:1em;display:inline-block;margin-left:-0.5em;margin-right:0.5em;text-align:right;direction:rtl;}/*!sc*/
.jhgzPU table{margin-left:auto;margin-right:auto;border-spacing:0;font-size:0.9em;}/*!sc*/
.jhgzPU td,.jhgzPU th{border-bottom:solid 1px var(--color-2);padding:0.5rem;}/*!sc*/
.jhgzPU th{font-weight:var(--font-weight-heavy);}/*!sc*/
.jhgzPU tr:hover{background:var(--color-2);}/*!sc*/
.jhgzPU tr:last-of-type td{border-bottom:0;}/*!sc*/
.jhgzPU blockquote{padding-left:1rem;border-left:solid 0.25rem var(--color-3);color:var(--color-mid);}/*!sc*/
data-styled.g30[id="Poststyles__Content-sc-12qb97v-7"]{content:"jhgzPU,"}/*!sc*/
@-webkit-keyframes hTUzwZ{0%{background-position:0% 82%;}50%{background-position:100% 19%;}100%{background-position:0% 82%;}}/*!sc*/
@keyframes hTUzwZ{0%{background-position:0% 82%;}50%{background-position:100% 19%;}100%{background-position:0% 82%;}}/*!sc*/
data-styled.g31[id="sc-keyframes-hTUzwZ"]{content:"hTUzwZ,"}/*!sc*/
.jjKdZc{position:fixed;top:0;left:0;right:0;height:0.25rem;background-color:var(--color-1);-webkit-transition:opacity 0.25s ease-out;transition:opacity 0.25s ease-out;z-index:2;}/*!sc*/
data-styled.g32[id="post__ScrollTrackerContainer-gh0jqu-0"]{content:"jjKdZc,"}/*!sc*/
</style><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml"/></head><body><div id="root"><nav class="Navigation__Container-sc-1yk0pqp-0 iuDFSN"><div class="ui__Fit-prwz6b-0 Navigation__NavFit-sc-1yk0pqp-1 izuwCZ"><p class="logo"><a href="/">Cisne.dev blog</a></p><div class="Navigation__BrightnessContainer-sc-1yk0pqp-2 TctaC"><div class="Navigation__BrightnessSpinner-sc-1yk0pqp-3 sLeDt"><button title="Mudar para modo diurno" aria-label="Mudar para modo diurno" class="Navigation__ClearButton-sc-1yk0pqp-4 Navigation__BrightnessIcon-sc-1yk0pqp-5 frsARl">🌙</button><button title="Mudar para modo noturno" aria-label="Mudar para modo noturno" class="Navigation__ClearButton-sc-1yk0pqp-4 Navigation__BrightnessIcon-sc-1yk0pqp-5 frsARl">☀️</button></div></div></div></nav><main><div class="ui__Fit-prwz6b-0 CfxHf"><div><div style="width:0%;opacity:0" class="post__ScrollTrackerContainer-gh0jqu-0 jjKdZc"></div><article class="Poststyles__Container-sc-12qb97v-4 kyWzPB"><h1 class="Poststyles__Title-sc-12qb97v-5 hhBwVH"><a href="/animacoes-em-javascript-a-60-fps/">Animações em JavaScript a 60 fps</a></h1><p class="Poststyles__Meta-sc-12qb97v-6 fonWHZ">Publicado em <!-- -->6 jul 2020<!-- -->. Uns <!-- -->5<!-- --> minutos de leitura.</p><div class="Poststyles__Content-sc-12qb97v-7 jhgzPU content"><p>Na era do CSS moderno, eu falar em animações feitas com JavaScript pode fazer você achar que estou desenterrando cadáveres. Com o CSS atual, a vida de quem quer fazer animações bonitas e rápidas melhorou bastante. Infelizmente, nem tudo dá para animar com CSS ainda, e algumas coisas precisam ser feitas na mão, via JavaScript.</p><span><!-- summary-break --></span><blockquote><p>Esse post é uma versão atualizada de um tutorial que escrevi em 2016.</p></blockquote><p>Recentemente, eu precisei animar a mudança de cor de fundo em um elemento, que era um <strong>radial-gradient</strong>. Isso não pode ser feito apenas com CSS da maneira que eu queria, então parti para o JavaScript. O problema? Ficou feio, meio lerdo, com umas travadas. Eu queria uma animação que rodasse a 60 ~first person shooters~ frames por segundo, e consegui esse feito usando o requestAnimationFrame. Vou te contar como fiz!</p><h2>Objetivo: animar um gradiente</h2><p>Meu objetivo é fazer com que a cor central de um gradiente radial se expandisse aos poucos até tomar o elemento inteiro (para fins de exemplo, estou usando apenas 2 cores, então vai ser só um círculo vermelho crescendo e ficando mais nítido). Se eu pudesse fazer o que quero diretamente com CSS, seria algo assim:</p><pre class="refractor language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>example-fake<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><pre class="refractor language-css"><code class="language-css"><span class="token selector">#example-fake</span> <span class="token punctuation">{</span>
  <span class="token property">animate</span><span class="token punctuation">:</span> change-bg 1s<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 30rem<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 30rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Isso NÃO funciona */</span>
<span class="token atrule"><span class="token rule">@keyframes</span> change-bg</span> <span class="token punctuation">{</span>
  <span class="token selector">from</span> <span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle<span class="token punctuation">,</span> tomato 25%<span class="token punctuation">,</span> white 50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">to</span> <span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle<span class="token punctuation">,</span> tomato 50%<span class="token punctuation">,</span> white 50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Como eu falei, <strong>isso não funciona</strong>. Você não pode animar o <code>color-stop</code> de um gradiente via CSS. Vamos fazer isso com JavaScript?</p><h2>O jeito tradicional: <code>setInterval</code> / <code>setTimeout</code></h2><p>A primeira coisa que vem na sua cabeça (ou não) quando você pensa em animar com JavaScript é o uso de timeouts. A ideia é fazer uma função que atualiza o valor do percentual no gradiente, baseada em quanto tempo se passou.</p><p>Para garantir que o delay de execução com timeout não interfira na duração da animação, ao invés de contar o tempo restante, vamos calcular o tempo restante baseado no momento que iniciou.</p><div class="MarkdownRendererstyles__LiveCodeContainer-i4h55e-1 jLFdFk live-code-container"><div class="sources"><pre class="refractor language-js"><code class="language-js"><span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#example-1&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialTime <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> currentTime <span class="token operator">-</span> initialTime<span class="token punctuation">;</span>
  <span class="token keyword">const</span> percent <span class="token operator">=</span> <span class="token number">25</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">/</span> duration<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">;</span>
  
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">radial-gradient(circle, tomato </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>percent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%, white 50%)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elapsedTime <span class="token operator">&gt;</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="refractor language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>example-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><pre class="refractor language-css"><code class="language-css"><span class="token selector">#example-1</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">min-height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><div class="MarkdownRendererstyles__HtmlContainer-i4h55e-0 MarkdownRenderer___StyledHtmlContainer-sc-185v3us-0 dfdSCV result"><div><div id="example-1"></div></div><button class="MarkdownRendererstyles__RunScriptButton-i4h55e-2 jcbAWj">🏃 Rodar</button></div></div><p>Funciona? Sim, mas tem alguns problemas. O principal deles é aquele número <code>100</code> ali embaixo. <strong>De onde ele veio???</strong> Resposta: foi um chute. Ao colocar 100, essa animação vai rodar 10 vezes por segundo. Por isso a animação roda meio estranha. Para rodar a 60 FPS, eu teria que colocar o valor de <code>1000 / 60</code>. Se você o fizer, dá uma melhorada, provavelmente.</p><p>Porém, existem alguns outros problemas associados. Nem todo dispositivo vai rodar a 60 FPS, e você está desperdiçando recursos. A depender dos recursos (ex.: tem placa de vídeo? está na bateria? está em primeiro plano ou minimizado?), o navegador vai tentar desenhar sua página numa quantidade de frames por segundo diferente.</p><p>A mensagem importante aqui é: <strong>não adianta você atualizar seu elemento numa velocidade diferente da que o navegador pode/quer desenhar na tela</strong>. Ou seja, você deveria mudar o valor animado apenas quando o navegador estiver <strong>disposto a desenhar novamente</strong>.</p><h2>A solução: <code>requestAnimationFrame</code></h2><p>Os navegadores modernos contam com uma função extremamente útil para animações: <code>requestAnimationFrame</code>. Essa função diz ao navegador que você gostaria de atualizar algo na tela. Então, quando ele estiver pronto para redesenhar, ele deve antes chamar sua função.</p><p>Se o navegador for atualizar a tela 60 vezes por segundo, ele chamará sua função 60 vezes apenas. Se for menos, ele chama menos. Se for mais, ele chama mais. Ou seja, sua animação não tem mais um frame rate definido. O frame rate será o do navegador, que é o único que importa de verdade, no fim das contas.</p><p>Vamos re-escrever o código acima para chamar o <code>requestAnimationFrame</code> &quot;recursivamente&quot; até a animação acabar (não é uma recursão literal pois é assíncrono).</p><div class="MarkdownRendererstyles__LiveCodeContainer-i4h55e-1 jLFdFk live-code-container"><div class="sources"><pre class="refractor language-js"><code class="language-js"><span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#example-2&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialTime <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateGradient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> currentTime <span class="token operator">-</span> initialTime<span class="token punctuation">;</span>
  <span class="token keyword">const</span> percent <span class="token operator">=</span> <span class="token number">25</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">/</span> duration<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">;</span>

  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">radial-gradient(circle, tomato </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>percent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%, white 50%)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>elapsedTime <span class="token operator">&lt;=</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateGradient<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateGradient<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="refractor language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>example-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><pre class="refractor language-css"><code class="language-css"><span class="token selector">#example-2</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">min-height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><div class="MarkdownRendererstyles__HtmlContainer-i4h55e-0 MarkdownRenderer___StyledHtmlContainer-sc-185v3us-0 cnLVdW result"><div><div id="example-2"></div></div><button class="MarkdownRendererstyles__RunScriptButton-i4h55e-2 jcbAWj">🏃 Rodar</button></div></div><p>Note que a mudança no código é quase imperceptível. Apenas criei uma função nomeada para atualizar o gradiente (<code>updateGradient</code>). No final, ao invés de parar a animação quando termina como fiz com o <code>setInterval</code>, ela verifica se ainda precisa animar e chama <code>requestAnimationFrame</code> novamente. Note que para a animação começar, precisei chamar o <code>requestAnimationFrame</code> pela primeira vez, também.</p><p><strong>Pronto!</strong> A animação agora vai executar em sincronia com o frame rate do navegador. Isso garante animações não só suaves e visualmente agradáveis, como um ganho em performance (leia-se: economizar bateria do seu usuário), pois se o navegador precisar diminuir o frame rate, seu código não vai ficar atualizando a animação inutilmente.</p><h2>Toques finais</h2><p>Eu usei um exemplo de animação simples para ficar fácil de visualizar o que estava acontecendo. Mas você pode usar a mesma ideia para fazer qualquer animação de maneira suave e performática!</p><p>Para que tudo funcione corretamente, é importante que você chame a próxima iteração do <code>requestAnimationFrame</code> dentro da função que você passa para ele.</p><p>Note que esse é um recurso recente (<em>ou era quando escrevi esse artigo pela primeira vez, em 2016</em>). Os navegadores modernos, em geral, já implementam. Mas, se você quer aumentar o suporte, você pode usar um Polyfill.</p><h2>Links úteis</h2><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">Documentação e exemplos na MDN</a></li><li><a href="http://caniuse.com/requestAnimationFrame">Lista de suporte dos navegadores</a></li><li><a href="https://gist.github.com/paulirish/1579671">Polyfill para navegadores antigos</a></li></ul></div><hr/><div class="Poststyles__AfterPost-sc-12qb97v-0 tuaWG"><p class="Poststyles__AfterPostChild-sc-12qb97v-1 gkeqUt">Gostou? <a href="https://twitter.com/intent/tweet?text=%22Anima%C3%A7%C3%B5es%20em%20JavaScript%20a%2060%20fps%22%20por%20%40Cisneiros%0A%0Ahttps%3A%2F%2Fblog.cisne.dev%2Fanimacoes-em-javascript-a-60-fps" target="_blank" rel="noopener noreferrer">Que tal compartilhar?</a></p><p class="Poststyles__AfterPostChild-sc-12qb97v-1 Poststyles__Tags-sc-12qb97v-2 fAvgXR">Tags: <span class="Poststyles__Tag-sc-12qb97v-3 kSZCZX"><a href="/tag/javascript">javascript</a></span><span class="Poststyles__Tag-sc-12qb97v-3 kSZCZX"><a href="/tag/frontend">frontend</a></span></p></div></article></div></div></main><footer class="Footer__Container-b3q04c-0 gdHjSq"><div class="ui__Fit-prwz6b-0 Footer__FooterFit-b3q04c-1 layJcq"><p>© <a href="https://cisne.dev">Alexandre Cisneiros</a></p><p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA 4.0</a></p></div></footer></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/src/containers/post\",\"sharedHashesByProp\":{},\"data\":{\"postData\":{\"title\":\"Anima\u00E7\u00F5es em JavaScript a 60 fps\",\"date\":\"2020-07-06T00:00:00-03:00\",\"slug\":\"animacoes-em-javascript-a-60-fps\",\"tags\":[\"javascript\",\"frontend\"],\"filePath\":\"2020-07-06-animacoes-em-javascript-a-60-fps.md\",\"content\":\"Na era do CSS moderno, eu falar em anima\u00E7\u00F5es feitas com JavaScript pode fazer voc\u00EA achar que estou desenterrando cad\u00E1veres. Com o CSS atual, a vida de quem quer fazer anima\u00E7\u00F5es bonitas e r\u00E1pidas melhorou bastante. Infelizmente, nem tudo d\u00E1 para animar com CSS ainda, e algumas coisas precisam ser feitas na m\u00E3o, via JavaScript.\\n\\n\u003C!-- summary-break -->\\n\\n> Esse post \u00E9 uma vers\u00E3o atualizada de um tutorial que escrevi em 2016.\\n\\nRecentemente, eu precisei animar a mudan\u00E7a de cor de fundo em um elemento, que era um **radial-gradient**. Isso n\u00E3o pode ser feito apenas com CSS da maneira que eu queria, ent\u00E3o parti para o JavaScript. O problema? Ficou feio, meio lerdo, com umas travadas. Eu queria uma anima\u00E7\u00E3o que rodasse a 60 ~first person shooters~ frames por segundo, e consegui esse feito usando o requestAnimationFrame. Vou te contar como fiz!\\n\\n## Objetivo: animar um gradiente\\n\\nMeu objetivo \u00E9 fazer com que a cor central de um gradiente radial se expandisse aos poucos at\u00E9 tomar o elemento inteiro (para fins de exemplo, estou usando apenas 2 cores, ent\u00E3o vai ser s\u00F3 um c\u00EDrculo vermelho crescendo e ficando mais n\u00EDtido). Se eu pudesse fazer o que quero diretamente com CSS, seria algo assim:\\n\\n```html\\n<div id=\\\"example-fake\\\"></div>\\n```\\n\\n```css\\n#example-fake {\\n  animate: change-bg 1s;\\n  width: 30rem;\\n  height: 30rem;\\n}\\n\\n/* Isso N\u00C3O funciona */\\n@keyframes change-bg {\\n  from {\\n    background-image: radial-gradient(circle, tomato 25%, white 50%);\\n  }\\n  to {\\n    background-image: radial-gradient(circle, tomato 50%, white 50%);\\n  }\\n}\\n```\\n\\nComo eu falei, **isso n\u00E3o funciona**. Voc\u00EA n\u00E3o pode animar o `color-stop` de um gradiente via CSS. Vamos fazer isso com JavaScript?\\n\\n## O jeito tradicional: `setInterval` / `setTimeout`\\n\\nA primeira coisa que vem na sua cabe\u00E7a (ou n\u00E3o) quando voc\u00EA pensa em animar com JavaScript \u00E9 o uso de timeouts. A ideia \u00E9 fazer uma fun\u00E7\u00E3o que atualiza o valor do percentual no gradiente, baseada em quanto tempo se passou.\\n\\nPara garantir que o delay de execu\u00E7\u00E3o com timeout n\u00E3o interfira na dura\u00E7\u00E3o da anima\u00E7\u00E3o, ao inv\u00E9s de contar o tempo restante, vamos calcular o tempo restante baseado no momento que iniciou.\\n\\n:::live\\n```js\\nconst element = document.querySelector('#example-1');\\nconst initialTime = +new Date();\\nconst duration = 1000;\\n\\nconst interval = setInterval(() => {\\n  const currentTime = +new Date();\\n  const elapsedTime = currentTime - initialTime;\\n  const percent = 25 + Math.min(elapsedTime / duration, 1) * 25;\\n  \\n  element.style.backgroundImage = `radial-gradient(circle, tomato ${percent}%, white 50%)`;\\n  if (elapsedTime > duration) {\\n    clearInterval(interval);\\n  }\\n}, 100);\\n```\\n```html\\n<div id=\\\"example-1\\\"></div>\\n```\\n```css\\n#example-1 {\\n  width: 200px;\\n  min-height: 200px;\\n}\\n```\\n:::/live\\n\\nFunciona? Sim, mas tem alguns problemas. O principal deles \u00E9 aquele n\u00FAmero `100` ali embaixo. **De onde ele veio???** Resposta: foi um chute. Ao colocar 100, essa anima\u00E7\u00E3o vai rodar 10 vezes por segundo. Por isso a anima\u00E7\u00E3o roda meio estranha. Para rodar a 60 FPS, eu teria que colocar o valor de `1000 / 60`. Se voc\u00EA o fizer, d\u00E1 uma melhorada, provavelmente.\\n\\nPor\u00E9m, existem alguns outros problemas associados. Nem todo dispositivo vai rodar a 60 FPS, e voc\u00EA est\u00E1 desperdi\u00E7ando recursos. A depender dos recursos (ex.: tem placa de v\u00EDdeo? est\u00E1 na bateria? est\u00E1 em primeiro plano ou minimizado?), o navegador vai tentar desenhar sua p\u00E1gina numa quantidade de frames por segundo diferente.\\n\\nA mensagem importante aqui \u00E9: **n\u00E3o adianta voc\u00EA atualizar seu elemento numa velocidade diferente da que o navegador pode/quer desenhar na tela**. Ou seja, voc\u00EA deveria mudar o valor animado apenas quando o navegador estiver **disposto a desenhar novamente**.\\n\\n## A solu\u00E7\u00E3o: `requestAnimationFrame`\\n\\nOs navegadores modernos contam com uma fun\u00E7\u00E3o extremamente \u00FAtil para anima\u00E7\u00F5es: `requestAnimationFrame`. Essa fun\u00E7\u00E3o diz ao navegador que voc\u00EA gostaria de atualizar algo na tela. Ent\u00E3o, quando ele estiver pronto para redesenhar, ele deve antes chamar sua fun\u00E7\u00E3o.\\n\\nSe o navegador for atualizar a tela 60 vezes por segundo, ele chamar\u00E1 sua fun\u00E7\u00E3o 60 vezes apenas. Se for menos, ele chama menos. Se for mais, ele chama mais. Ou seja, sua anima\u00E7\u00E3o n\u00E3o tem mais um frame rate definido. O frame rate ser\u00E1 o do navegador, que \u00E9 o \u00FAnico que importa de verdade, no fim das contas.\\n\\nVamos re-escrever o c\u00F3digo acima para chamar o `requestAnimationFrame` \\\"recursivamente\\\" at\u00E9 a anima\u00E7\u00E3o acabar (n\u00E3o \u00E9 uma recurs\u00E3o literal pois \u00E9 ass\u00EDncrono).\\n\\n:::live\\n```js\\nconst element = document.querySelector('#example-2');\\nconst initialTime = +new Date();\\nconst duration = 1000;\\n\\nfunction updateGradient() {\\n  const currentTime = +new Date();\\n  const elapsedTime = currentTime - initialTime;\\n  const percent = 25 + Math.min(elapsedTime / duration, 1) * 25;\\n\\n  element.style.backgroundImage = `radial-gradient(circle, tomato ${percent}%, white 50%)`;\\n\\n  if (elapsedTime <= duration) {\\n    requestAnimationFrame(updateGradient);\\n  }\\n}\\n\\nrequestAnimationFrame(updateGradient);\\n```\\n```html\\n<div id=\\\"example-2\\\"></div>\\n```\\n```css\\n#example-2 {\\n  width: 200px;\\n  min-height: 200px;\\n}\\n```\\n:::/live\\n\\nNote que a mudan\u00E7a no c\u00F3digo \u00E9 quase impercept\u00EDvel. Apenas criei uma fun\u00E7\u00E3o nomeada para atualizar o gradiente (`updateGradient`). No final, ao inv\u00E9s de parar a anima\u00E7\u00E3o quando termina como fiz com o `setInterval`, ela verifica se ainda precisa animar e chama `requestAnimationFrame` novamente. Note que para a anima\u00E7\u00E3o come\u00E7ar, precisei chamar o `requestAnimationFrame` pela primeira vez, tamb\u00E9m.\\n\\n**Pronto!** A anima\u00E7\u00E3o agora vai executar em sincronia com o frame rate do navegador. Isso garante anima\u00E7\u00F5es n\u00E3o s\u00F3 suaves e visualmente agrad\u00E1veis, como um ganho em performance (leia-se: economizar bateria do seu usu\u00E1rio), pois se o navegador precisar diminuir o frame rate, seu c\u00F3digo n\u00E3o vai ficar atualizando a anima\u00E7\u00E3o inutilmente.\\n\\n## Toques finais\\n\\nEu usei um exemplo de anima\u00E7\u00E3o simples para ficar f\u00E1cil de visualizar o que estava acontecendo. Mas voc\u00EA pode usar a mesma ideia para fazer qualquer anima\u00E7\u00E3o de maneira suave e perform\u00E1tica!\\n\\nPara que tudo funcione corretamente, \u00E9 importante que voc\u00EA chame a pr\u00F3xima itera\u00E7\u00E3o do `requestAnimationFrame` dentro da fun\u00E7\u00E3o que voc\u00EA passa para ele.\\n\\nNote que esse \u00E9 um recurso recente (_ou era quando escrevi esse artigo pela primeira vez, em 2016_). Os navegadores modernos, em geral, j\u00E1 implementam. Mas, se voc\u00EA quer aumentar o suporte, voc\u00EA pode usar um Polyfill.\\n\\n## Links \u00FAteis\\n\\n- [Documenta\u00E7\u00E3o e exemplos na MDN](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)\\n- [Lista de suporte dos navegadores](http://caniuse.com/requestAnimationFrame)\\n- [Polyfill para navegadores antigos](https://gist.github.com/paulirish/1579671)\\n\",\"readingTime\":5,\"summary\":\"Na era do CSS moderno, eu falar em anima\u00E7\u00F5es feitas com JavaScript pode fazer voc\u00EA achar que estou desenterrando cad\u00E1veres. Com o CSS atual, a vida de quem quer fazer anima\u00E7\u00F5es bonitas e r\u00E1pidas melhorou bastante. Infelizmente, nem tudo d\u00E1 para animar com CSS ainda, e algumas coisas precisam ser feitas na m\u00E3o, via JavaScript.\\n\\n\"}},\"path\":\"animacoes-em-javascript-a-60-fps\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/vendors~__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.207edc50.js"></script><script defer="" type="text/javascript" src="/templates/__react_static_root__/src/containers/post~__react_static_root__/src/containers/postList.a04ea84b.js"></script><script defer="" type="text/javascript" src="/templates/__react_static_root__/src/containers/post.d8dd52db.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.272ae1d1.js"></script><script defer="" type="text/javascript" src="/main.f19d4c14.js"></script></body></html>